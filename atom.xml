<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Zinway's Blog]]></title>
  <subtitle><![CDATA[Talk about the Soy Sauce]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://zin.so/"/>
  <updated>2014-12-22T10:45:21.134Z</updated>
  <id>http://zin.so/</id>
  
  <author>
    <name><![CDATA[Zinway]]></name>
    <email><![CDATA[zinway@qq.com]]></email>
  </author>
  
  <generator uri="http://zespia.tw/hexo/">Hexo</generator>
  
  <entry>
    <title><![CDATA[办公室自动翻墙]]></title>
    <link href="http://zin.so/2014/12/22/auto-break-gfw/"/>
    <id>http://zin.so/2014/12/22/auto-break-gfw/</id>
    <published>2014-12-22T10:28:44.000Z</published>
    <updated>2014-12-22T10:41:18.000Z</updated>
    <content type="html"><![CDATA[<p>引子：<br>凑巧的是我5月中旬给公司搭了个翻墙环境来加速Google和Gmail的访问速度，然后5月27号Google就开始被封了 Orz ，然后就正好用上了这一套系统，后面就是不断地完善和优化，然后最近有空就Blog出来。</p>
<p>需求:</p>
<ol>
<li>希望能够尽量透明地免设置地实现自动翻墙；</li>
<li>尽量不影响墙内站点的访问速度；</li>
<li>尽可能地便于维护和更新。</li>
</ol>
<p>整个自动翻墙分为这么几块：</p>
<ol>
<li>VPN（翻墙的跳板，我们这边选择了OpenVPN）；</li>
<li>路由（定制墙外路由以及NAT，实现“自动”）；</li>
<li>DNS（防止DNS污染以及CDN的正确解析）。</li>
</ol>
<h2 id="VPN_Server搭建">VPN Server搭建</h2>
<p>OpenVPN的搭建可以参考这一篇文章：<a href="http://zin.so/2014/08/21/how-to-install-openvpn-server-on-centos-7/" target="_blank" rel="external">在CentOS 7上安装OpenVPN Server</a></p>
<h2 id="路由定制及NAT">路由定制及NAT</h2>
<p>使用OpenVPN Server将墙外的IP列表push给Client，在办公室网关上启一个OpenVPN Client并且开转发和NAT。<br>为了便于实现路由表的更新，我们使用了 client-config-dir，也就是 ccd 以及 push-continuation，将需要 push 的路由表放入 ccd 之中，配合 management console, 在更新了ccd 之中的路由表之后在 console 里面kill掉相关的client，这样 client 就会自动重连并且得到新的路由表，client 和 server 均无需重启。<br>翻墙路由表可参考<a href="https://github.com/zinw/VPN" target="_blank" rel="external">GFW 境外列表（部分）</a>。</p>
<h2 id="DNS转发及优化">DNS转发及优化</h2>
<p>为了方便管理和速度上的保证，我们没有直接使用bind，而是用dnsmasq来转发。<br>使用iptables来过滤DNS污染可以参考这一篇文章：<a href="http://zin.so/2014/12/19/anti-dns-poison-with-iptables/" target="_blank" rel="external">通过iptables去除DNS污染</a><br>dnsmasq默认把DNS丢给OpenDNS，一些CDN域名用dnsmasq.server的配置文件来丢给国内的DNS，一些需要定制IP地址的就用dnsmasq.address配置文件来个性化。</p>
<h2 id="持续维护">持续维护</h2>
<p>这一套系统我们需要维护2个表：<br>1个墙外路由表（一些个性化的墙外网站的访问需求）；<br>1个dnsmasq.server表（主要是CDN域名，这个只能发现以后一点一点加）。</p>
]]></content>
    
    
      <category term="VPN" scheme="http://zin.so/tags/VPN/"/>
    
      <category term="NAT" scheme="http://zin.so/tags/NAT/"/>
    
      <category term="DNS" scheme="http://zin.so/tags/DNS/"/>
    
      <category term="Network" scheme="http://zin.so/categories/Network/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[通过iptables去除DNS污染]]></title>
    <link href="http://zin.so/2014/12/19/anti-dns-poison-with-iptables/"/>
    <id>http://zin.so/2014/12/19/anti-dns-poison-with-iptables/</id>
    <published>2014-12-19T08:26:07.000Z</published>
    <updated>2014-12-22T06:09:48.000Z</updated>
    <content type="html"><![CDATA[<p><strong>GFW的DNS劫持原理</strong>说起来挺简单，GFW对境外DNS的劫持，是在发现你请求敏感域名的DNS记录时，伪装成你请求的DNS返回一个污染的数据包给你的解析器，但并不会丢弃你向境外DNS的请求，也不会丢弃境外DNS返回的正确解析结果，他只是让错误的数据抢先回来欺骗了你的解析器而已，毕竟他直接从国内给你发污染数据怎么都比国外DNS返回正确数据要快，而解析器在先收到了欺骗数据包之后，就不会再管后面返回的正确数据了，这样你就被DNS劫持了。</p>
<p><strong>一般的解决办法</strong>就是通过VPN通道访问DNS服务器，以获得干净的解析结果。本文的解决方案：我们可以在iptables的防火墙规则中，检测UDP的源端口为53的数据（DNS查询是通过UDP查询服务器的53端口实现的），一旦发现解析数据中包含有被GFW常用的用于DNS污染和劫持的IP，就丢弃这个数据包，对dnsmasq这些解析器来说污染的数据包根本就不会到达（本文涉及的iptables规则会抢先于任何应用先处理网络数据），等正确的境外DNS返回的数据到达后并不会被过滤，这样dnsmasq就获得了正确的DNS解析数据。</p>
<p>首先我们要找到被GFW用于DNS污染和劫持的IP，目前搜集并统计到的无效IP（参考<a href="https://github.com/clowwindy/ChinaDNS-C/blob/master/iplist.txta" target="_blank" rel="external">clowwindy的iplist.txt</a>）如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">118.5.49.6</div><div class="line">128.121.126.139</div><div class="line">159.106.121.75</div><div class="line">169.132.13.103</div><div class="line">188.5.4.96</div><div class="line">189.163.17.5</div><div class="line">192.67.198.6</div><div class="line">197.4.4.12</div><div class="line">202.106.1.2</div><div class="line">202.181.7.85</div><div class="line">203.161.230.171</div><div class="line">203.98.7.65</div><div class="line">207.12.88.98</div><div class="line">208.56.31.43</div><div class="line">209.145.54.50</div><div class="line">209.220.30.174</div><div class="line">209.36.73.33</div><div class="line">209.85.229.138</div><div class="line">211.94.66.147</div><div class="line">213.169.251.35</div><div class="line">216.221.188.182</div><div class="line">216.234.179.13</div><div class="line">23.89.5.60</div><div class="line">243.185.187.39</div><div class="line">249.129.46.48</div><div class="line">253.157.14.165</div><div class="line">37.61.54.158</div><div class="line">4.36.66.178</div><div class="line">46.82.174.68</div><div class="line">49.2.123.56</div><div class="line">54.76.135.1</div><div class="line">59.24.3.173</div><div class="line">64.33.88.161</div><div class="line">64.33.99.47</div><div class="line">64.66.163.251</div><div class="line">65.104.202.252</div><div class="line">65.160.219.113</div><div class="line">66.45.252.237</div><div class="line">72.14.205.104</div><div class="line">72.14.205.99</div><div class="line">74.125.127.102</div><div class="line">74.125.155.102</div><div class="line">74.125.39.102</div><div class="line">74.125.39.113</div><div class="line">77.4.7.92</div><div class="line">78.16.49.15</div><div class="line">8.7.198.45</div><div class="line">93.46.8.89</div></pre></td></tr></table></figure>

<p>后面需要用到这些IP的16进制，本文推荐个转换工具netmask（附<a href="https://github.com/zinw/VPN/raw/master/netmask_2.3.12.tar.gz" target="_blank" rel="external">netmask源码包</a>）。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"> <span class="comment"># netmask --help</span></div><div class="line">This is netmask, <span class="operator">an</span> address netmask generation utility</div><div class="line">Usage: netmask spec [spec ...]</div><div class="line">  -h, <span class="comment">--helpPrint a summary of the options</span></div><div class="line">  -v, <span class="comment">--versionPrint the version number</span></div><div class="line">  -d, <span class="comment">--debugPrint status/progress information</span></div><div class="line">  -s, <span class="comment">--standardOutput address/netmask pairs</span></div><div class="line">  -c, <span class="comment">--cidrOutput CIDR format address lists</span></div><div class="line">  -i, <span class="comment">--ciscoOutput Cisco style address lists</span></div><div class="line">  -r, <span class="comment">--rangeOutput ip address ranges</span></div><div class="line">  -x, <span class="comment">--hexOutput address/netmask pairs in hex</span></div><div class="line">  -o, <span class="comment">--octalOutput address/netmask pairs in octal</span></div><div class="line">  -b, <span class="comment">--binaryOutput address/netmask pairs in binary</span></div><div class="line">  -n, <span class="comment">--nodnsDisable DNS lookups for addresses</span></div><div class="line">Definitions:</div><div class="line">  <span class="operator">a</span> spec can be <span class="keyword">any</span> <span class="operator">of</span>:</div><div class="line">    address</div><div class="line">    address:address</div><div class="line">    address:+address</div><div class="line">    address/mask</div><div class="line">  <span class="operator">an</span> address can be <span class="keyword">any</span> <span class="operator">of</span>:</div><div class="line">    NULLCMD=decimal <span class="built_in">number</span></div><div class="line">    <span class="number">0</span>Noctal <span class="built_in">number</span></div><div class="line">    <span class="number">0</span>xNhex <span class="built_in">number</span></div><div class="line">    N.N.N.Ndotted quad</div><div class="line">    hostname dns domain name</div><div class="line">  <span class="operator">a</span> mask is <span class="operator">the</span> <span class="built_in">number</span> <span class="operator">of</span> bits <span class="built_in">set</span> <span class="built_in">to</span> <span class="constant">one</span> <span class="built_in">from</span> <span class="operator">the</span> left</div></pre></td></tr></table></figure>

<p>用下面的命令进行点分十进制转十六进制处理：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">netmask -x `cat iplist.txt` |cut <span class="operator">-d</span>/ <span class="operator">-f</span>1 |cut -dx <span class="operator">-f</span>2</div></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="number">042442</span>b2</div><div class="line"><span class="number">0807</span>c62d</div><div class="line"><span class="number">1759053</span>c</div><div class="line"><span class="number">253</span>d369e</div><div class="line"><span class="number">2e52</span>ae44</div><div class="line"><span class="number">31027</span>b38</div><div class="line"><span class="number">364</span>c8701</div><div class="line"><span class="number">3</span>b1803ad</div><div class="line"><span class="number">402158</span>a1</div><div class="line"><span class="number">4021632f</span></div><div class="line"><span class="number">4042</span>a3fb</div><div class="line"><span class="number">4168</span>cafc</div><div class="line"><span class="number">41</span>a0db71</div><div class="line"><span class="number">422</span>dfced</div><div class="line"><span class="number">480</span>ecd63</div><div class="line"><span class="number">480</span>ecd68</div><div class="line"><span class="number">4</span>a7d2766</div><div class="line"><span class="number">4</span>a7d2771</div><div class="line"><span class="number">4</span>a7d7f66</div><div class="line"><span class="number">4</span>a7d9b66</div><div class="line"><span class="number">4</span>d04075c</div><div class="line"><span class="number">4e10310</span>f</div><div class="line"><span class="number">5</span>d2e0859</div><div class="line"><span class="number">76053106</span></div><div class="line"><span class="number">80797e8</span>b</div><div class="line"><span class="number">9f</span>6a794b</div><div class="line">a9840d67</div><div class="line">bc050460</div><div class="line">bda31105</div><div class="line">c043c606</div><div class="line">c504040c</div><div class="line">ca6a0102</div><div class="line">cab50755</div><div class="line">cb620741</div><div class="line">cba1e6ab</div><div class="line">cf0c5862</div><div class="line">d0381f2b</div><div class="line">d1244921</div><div class="line">d155e58a</div><div class="line">d1913632</div><div class="line">d1dc1eae</div><div class="line">d35e4293</div><div class="line">d5a9fb23</div><div class="line">d8ddbcb6</div><div class="line">d8eab30d</div><div class="line">f3b9bb27</div><div class="line">f9812e30</div><div class="line">fd9d0ea5</div></pre></td></tr></table></figure>

<p>然后就直接用iptables匹配包含这些ip的dns包并进行丢弃：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|042442b2|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div></pre></td></tr></table></figure>

<p>简单解释下，-m string表示启用string模块进行匹配，—algo bm表示启用贝叶(Boyer-Moore)字符串搜索算法，另一种算法是kmp(Knuth-Pratt-Morris)，具体应该只是效率和不同应用的区别，算法原理我就不细究了。<br>—hex-string就是要匹配的IP地址的HEX格式了，注意这里前面不要有0x表示16进制了，直接写16进制数据就行，后面跟着的就是IP地址的16进制格式。<br>—from 60 —to 180都是表示搜索的偏置范围(offset)，从第60 byte开始到180 byte结束，一般来说DNS返回包的长度很少有超过180字节，而IP值的位置因为协议格式的关系，基本上不可能出现在60字节之前，所以指定这个范围是足够的，同时也可以大大减轻搜索算法的运算压力。如果你担心有什么奇葩DNS返回的结果在这范围之外，删除这两个偏置选项就行了，这样会默认搜索整个字符串，但相应的搜索消耗的CPU资源就更多了。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|042442b2|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|0807c62d|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|1759053c|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|253d369e|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|2e52ae44|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|31027b38|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|364c8701|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|3b1803ad|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|402158a1|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|4021632f|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|4042a3fb|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|4168cafc|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|41a0db71|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|422dfced|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|480ecd63|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|480ecd68|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|4a7d2766|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|4a7d2771|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|4a7d7f66|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|4a7d9b66|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|4d04075c|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|4e10310f|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|5d2e0859|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|76053106|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|80797e8b|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|9f6a794b|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|a9840d67|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|bc050460|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|bda31105|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|c043c606|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|c504040c|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|ca6a0102|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|cab50755|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|cb620741|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|cba1e6ab|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|cf0c5862|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|d0381f2b|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|d1244921|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|d155e58a|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|d1913632|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|d1dc1eae|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|d35e4293|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|d5a9fb23|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|d8ddbcb6|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|d8eab30d|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|f3b9bb27|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|f9812e30|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div><div class="line">iptables -<span class="keyword">t</span> mangle -I PREROUTING -<span class="keyword">p</span> udp --sport <span class="number">53</span> -<span class="keyword">m</span> <span class="built_in">string</span> --algo <span class="keyword">bm</span> --hex-<span class="built_in">string</span> <span class="string">"|fd9d0ea5|"</span> --from <span class="number">60</span> --<span class="keyword">to</span> <span class="number">180</span> -<span class="keyword">j</span> DROP</div></pre></td></tr></table></figure>

<p>每个IP分别写一条这样的规则，然后就用你自己熟悉的方式来处理这些iptables规则。</p>
<hr>
<p><strong>More~</strong><br>iptables过滤空包：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">iptables -t mangle -I PREROUTING -p udp --sport <span class="number">53</span> -m <span class="keyword">u32</span> --<span class="keyword">u32</span> <span class="string">"0&0x0F000000=0x05000000 && 0&gt;&gt;22&0x3C@8&0x810F=0x8000 && 0&gt;&gt;22&0x3C@12&0xFFFF=0x0000"</span> -j DROP</div></pre></td></tr></table></figure>

<p>对关键部分解释下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="number">0</span>&gt;&gt;<span class="number">22</span>&<span class="number">0x3C</span>@<span class="number">8</span>&<span class="number">0x810F</span>=<span class="number">0x8000</span></div></pre></td></tr></table></figure>

<p>“0&gt;&gt;22&amp;0x3C”这部分是很常用的一个规则，你在别的地方也应该经常看到，表示取出IP报文头的长度，后面的@表示跳过这么多长度，也就是跳过IP头到UDP头部分。<br>8表示从第8个字节开始抓4个字节，其中第10个字节的第一位如果是1就表示这是一个响应包，0对应的是查询报，这个我们不用管；<br>第十个字节的最低位是RD位，劫持包的RD位是0；<br>第11个字节的低4位就是Reply Code的位置。<br>将这4个字节和0x810F做与操作就提出了响应标志位，RD位和Reply Code的值，判断出是一个RD=0，Reply Code为无错误的响应包，再继续和下面的规则匹配。<br>这三个条件缺一不可，尤其是对RD位的检查，这几乎是GFW劫持包最重要的特征。</p>
<hr>
<p>参考：</p>
<ul>
<li><a href="http://www.lifetyper.com/2014/06/anti-dns-poison-without-vpn.html" target="_blank" rel="external">无需VPN的OpenWRT DNS防污染方法</a></li>
<li><a href="https://github.com/clowwindy/ChinaDNS-C/blob/master/iplist.txt" target="_blank" rel="external">clowwindy/ChinaDNS-C/iplist.txt</a></li>
<li><a href="https://github.com/hackgfw/openwrt-gfw" target="_blank" rel="external">hackgfw/openwrt-gfw</a></li>
</ul>
]]></content>
    
    
      <category term="DNS" scheme="http://zin.so/tags/DNS/"/>
    
      <category term="iptables" scheme="http://zin.so/tags/iptables/"/>
    
      <category term="Network" scheme="http://zin.so/categories/Network/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Mac OSX光标控制]]></title>
    <link href="http://zin.so/2014/08/25/cursor-control-on-mac-osx/"/>
    <id>http://zin.so/2014/08/25/cursor-control-on-mac-osx/</id>
    <published>2014-08-25T03:38:07.000Z</published>
    <updated>2014-08-25T03:47:23.000Z</updated>
    <content type="html"><![CDATA[<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Ctrl+p  <span class="built_in">shell</span>中上一个命令，或者 文本中移动到上一行</div><div class="line">Ctrl+n  <span class="built_in">shell</span>中下一个命令，或者 文本中移动到下一行</div><div class="line">Ctrl+r  往后搜索历史命令</div><div class="line">Ctrl+s  往前搜索历史命令</div><div class="line">Ctrl+f  光标前移</div><div class="line">Ctrl+b  光标后退</div><div class="line">Ctrl+<span class="operator">a</span>  到行首</div><div class="line">Ctrl+e  到行尾</div><div class="line">Ctrl+d  删除一个字符，删除一个字符，相当于通常的Delete键</div><div class="line">Ctrl+h  退格删除一个字符，相当于通常的Backspace键</div><div class="line">Ctrl+u  删除到行首</div><div class="line">Ctrl+k  删除到行尾</div><div class="line">Ctrl+l  类似 <span class="built_in">clear</span> 命令效果</div><div class="line">Ctrl+y  粘贴</div></pre></td></tr></table></figure>

<p>你会发现，这些快捷键的定义，跟Emacs里面控制光标有雷同，其实Mac OS里面，所有允许输入文本的地方，都可以用上面的方法来控制光标的方向，不信你去试试吧……</p>
]]></content>
    
    
      <category term="Mac OSX" scheme="http://zin.so/tags/Mac-OSX/"/>
    
      <category term="Shell" scheme="http://zin.so/categories/Shell/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[在CentOS 7上安装OpenVPN Server]]></title>
    <link href="http://zin.so/2014/08/21/how-to-install-openvpn-server-on-centos-7/"/>
    <id>http://zin.so/2014/08/21/how-to-install-openvpn-server-on-centos-7/</id>
    <published>2014-08-21T09:34:35.000Z</published>
    <updated>2014-12-22T10:45:15.000Z</updated>
    <content type="html"><![CDATA[<h2 id="安装openvpn">安装openvpn</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">yum <span class="operator"><span class="keyword">install</span> -y openssl openssl-devel lzo lzo-devel pam pam-devel</span></div><div class="line">yum <span class="keyword">install</span> openvpn -y</div></pre></td></tr></table></figure>

<p>＊注：yum安装的方式需要有epel源。</p>
<h2 id="安装easy-rsa">安装easy-rsa</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cd</span> /etc/openvpn</div><div class="line">wget -<span class="keyword">c</span> http<span class="variable">s:</span>//github.<span class="keyword">com</span>/OpenVPN/easy-rsa/archive/master.zip</div><div class="line">unzip master.zip</div><div class="line">mv easy-rsa-master easy-rsa</div><div class="line">rm -<span class="keyword">f</span> master.zip</div></pre></td></tr></table></figure>

<h2 id="初始化pki">初始化pki</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cd</span> /etc/openvpn/easy-rsa/easyrsa3</div><div class="line">./easyrsa init-pki</div><div class="line">./easyrsa build-<span class="keyword">ca</span> nopass</div><div class="line">./easyrsa gen-req &lt;EntityName&gt; nopass</div><div class="line">./easyrsa <span class="keyword">sign</span>-req client &lt;EntityName&gt;</div><div class="line">./easyrsa gen-dh</div><div class="line"><span class="keyword">ln</span> -<span class="keyword">s</span> easy-rsa/easyrsa3/pki /etc/openvpn/pki</div><div class="line">openvpn --genkey --secret /etc/openvpn/pki/<span class="keyword">ta</span>.key</div></pre></td></tr></table></figure>

<p>＊注：easyrsa3的使用方法可以参考<a href="https://github.com/OpenVPN/easy-rsa/blob/master/README.quickstart.md" target="_blank" rel="external">这一篇easyrsa3官方文档</a></p>
<h2 id="配置server-conf">配置server.conf</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cd</span> /etc/openvpn</div><div class="line"><span class="keyword">cp</span> /usr/share/doc/openvpn-<span class="number">2.3</span>.<span class="number">2</span>/sample/sample-config-<span class="keyword">files</span>/server.<span class="keyword">conf</span> .</div><div class="line"><span class="keyword">vim</span> server.<span class="keyword">conf</span></div><div class="line">### 修改下列几项</div><div class="line"><span class="keyword">ca</span> pki/<span class="keyword">ca</span>.crt</div><div class="line">cert pki/issued/server.crt</div><div class="line">key pki/private/server.key</div><div class="line">dh pki/dh.pem</div><div class="line">tls-auth pki/<span class="keyword">ta</span>.key <span class="number">0</span></div><div class="line">user nobody</div><div class="line">group nobody</div><div class="line">status /var/<span class="built_in">log</span>/openvpn/openvpn-status.<span class="built_in">log</span></div><div class="line"><span class="built_in">log</span>         /var/<span class="built_in">log</span>/openvpn/openvpn.<span class="built_in">log</span></div><div class="line"><span class="built_in">log</span>-<span class="built_in">append</span>  /var/<span class="built_in">log</span>/openvpn/openvpn.<span class="built_in">log</span></div><div class="line">### 修改完成</div><div class="line"><span class="built_in">mkdir</span> /var/<span class="built_in">log</span>/openvpn</div></pre></td></tr></table></figure>

<h2 id="配置openvpn-service">配置openvpn.service</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cd</span> /usr/lib/systemd/<span class="built_in">system</span>/</div><div class="line">mv openvpn@.service openvpn.service</div><div class="line"><span class="keyword">vim</span> openvpn.service ### 修改pid和<span class="keyword">conf</span>文件名称</div><div class="line">systemctl enable openvpn.service</div><div class="line">systemctl start openvpn</div></pre></td></tr></table></figure>

<h2 id="配置NAT转发">配置NAT转发</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">echo <span class="string">"net.ipv4.ip_forward = 1"</span> <span class="input">&gt;&gt; /etc/sysctl.conf</span></div><div class="line"><span class="input"><span class="prompt">sysctl -p</span></span></div><div class="line">iptables -A INPUT -p UDP --dport 1194 -j ACCEPT</div><div class="line">iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -j MASQUERADE</div><div class="line">iptables-save &gt; /etc/sysconfig/iptables</div></pre></td></tr></table></figure>

<h2 id="打包客户端配置文件">打包客户端配置文件</h2>
<p>简单写了个打包脚本：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="shebang">#!/bin/bash</span></div><div class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> != <span class="number">1</span> ];<span class="keyword">then</span></div><div class="line">    <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$0</span> comName"</span></div><div class="line">    <span class="keyword">exit</span> <span class="number">1</span></div><div class="line"><span class="keyword">fi</span></div><div class="line">comName=<span class="variable">$1</span></div><div class="line">pkiDir=/etc/openvpn/easy-rsa/easyrsa3/pki</div><div class="line">ca_crtFile=<span class="variable">$pkiDir</span>/ca.crt</div><div class="line">crtFile=<span class="variable">$pkiDir</span>/issued/<span class="variable">$comName</span>.crt</div><div class="line">keyFile=<span class="variable">$pkiDir</span>/private/<span class="variable">$comName</span>.key</div><div class="line">ta_keyFile=<span class="variable">$pkiDir</span>/ta.key</div><div class="line">mkdir ~/<span class="variable">$comName</span>\_vpn</div><div class="line">cp <span class="variable">$ca_crtFile</span> <span class="variable">$crtFile</span> <span class="variable">$keyFile</span> <span class="variable">$ta_keyFile</span> ~/<span class="variable">$comName</span>\_vpn</div><div class="line">cat &gt; ~/<span class="variable">$comName</span>\_vpn/<span class="variable">$comName</span>.ovpn &lt;&lt;EOF</div><div class="line">client</div><div class="line">remote your.vpn.server</div><div class="line">proto udp</div><div class="line">dev tun</div><div class="line">ca ca.crt</div><div class="line">cert <span class="variable">$comName</span>.crt</div><div class="line">key <span class="variable">$comName</span>.key</div><div class="line">tls-auth ta.key <span class="number">1</span></div><div class="line">comp-lzo</div><div class="line">nobind</div><div class="line">EOF</div><div class="line"><span class="built_in">cd</span></div><div class="line">tar czvf <span class="variable">$comName</span>\_vpn.tgz <span class="variable">$comName</span>\_vpn</div></pre></td></tr></table></figure>

<h2 id="连接测试">连接测试</h2>
<p>客户端连接测试 &amp; trouble shooting</p>
]]></content>
    
    
      <category term="OpenVPN" scheme="http://zin.so/tags/OpenVPN/"/>
    
      <category term="CentOS 7" scheme="http://zin.so/tags/CentOS-7/"/>
    
      <category term="VPN" scheme="http://zin.so/tags/VPN/"/>
    
      <category term="NAT" scheme="http://zin.so/tags/NAT/"/>
    
      <category term="Tools" scheme="http://zin.so/categories/Tools/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[在Mac OSX上通过dd命令制作系统启动盘]]></title>
    <link href="http://zin.so/2014/08/18/dd-an-os-startup-disk-on-mac-osx/"/>
    <id>http://zin.so/2014/08/18/dd-an-os-startup-disk-on-mac-osx/</id>
    <published>2014-08-18T09:21:42.000Z</published>
    <updated>2014-08-21T09:48:12.000Z</updated>
    <content type="html"><![CDATA[<h2 id="将iso转换成img文件">将iso转换成img文件</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">$ hdiutil convert -format UDRW -o &lt;outfile&gt;</span> &lt;path_to_your_iso_file&gt;</span></div></pre></td></tr></table></figure>

<p>＊注：该命令会将iso文件转换成dmg文件，而且Mac OSX会默认在“outfile”后面追加一个“.dmg”。</p>
<h2 id="查看U盘的盘符">查看U盘的盘符</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$ diskutil list</div><div class="line">/dev/disk0</div><div class="line">   <span class="comment">#:                       TYPE NAME                    SIZE       IDENTIFIER</span></div><div class="line">   0:      GUID_partition_scheme                        <span class="keyword">*</span>251.0 GB   disk0</div><div class="line">   1:                        EFI EFI                     209.7 MB   disk0s1</div><div class="line">   2:          Apple_CoreStorage                         250.1 GB   disk0s2</div><div class="line">   3:                 Apple_Boot Recovery HD             650.0 MB   disk0s3</div><div class="line">/dev/disk1</div><div class="line">   <span class="comment">#:                       TYPE NAME                    SIZE       IDENTIFIER</span></div><div class="line">   0:                  Apple_HFS MHD                    <span class="keyword">*</span>248.4 GB   disk1</div><div class="line">                                 Logical Volume on disk0s2</div><div class="line">                                 04D26A4D-9A6E-448A-9017-8DA1804D4E93</div><div class="line">                                 Unencrypted</div><div class="line">/dev/disk2</div><div class="line">   <span class="comment">#:                       TYPE NAME                    SIZE       IDENTIFIER</span></div><div class="line">   0:      GUID_partition_scheme                        <span class="keyword">*</span>7.9 GB     disk2</div><div class="line">   1:                        EFI EFI                     209.7 MB   disk2s1</div><div class="line">   2:                  Apple_HFS Yosemite                7.6 GB     disk2s2</div></pre></td></tr></table></figure>

<p>＊注：该命令是查看当前系统上挂载的磁盘，其中/dev/disk2是我的U盘。不同的系统disk后面的数字可能不一样，但一般都是diskN的形式。</p>
<h2 id="卸载U盘">卸载U盘</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ diskutil unmountDisk /dev/disk2</div><div class="line">Unmount <span class="operator">of</span> all volumes <span class="command"><span class="keyword">on</span> <span class="title">disk2</span> <span class="title">was</span> <span class="title">successful</span></span></div></pre></td></tr></table></figure>

<p>＊注：该命令是卸载U盘挂载的卷，使U盘处于空闲状态。</p>
<h2 id="将dmg镜像写入U盘">将dmg镜像写入U盘</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$ </span>sudo dd <span class="keyword">if</span>=&lt;outfile.dmg&gt; of=<span class="regexp">/dev/rdisk</span>2 bs=<span class="number">1</span>m</div></pre></td></tr></table></figure>

<p>＊注1：该命令将第一步生成的dmg文件写入到U盘/dev/rdisk2（注意不是/dev/disk2）;<br>＊注2：该命令需要sudo权限；<br>＊注3：关于bs大小单位，BSD的dd要用小写“m、g”等，GNU的dd要用大写“M、G”等。</p>
<h2 id="弹出U盘">弹出U盘</h2>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ diskutil eject <span class="regexp">/dev/</span>disk2</div><div class="line">Disk <span class="regexp">/dev/</span>disk2 ejected</div></pre></td></tr></table></figure>

]]></content>
    
    
      <category term="dd" scheme="http://zin.so/tags/dd/"/>
    
      <category term="Mac OSX" scheme="http://zin.so/tags/Mac-OSX/"/>
    
      <category term="Shell" scheme="http://zin.so/categories/Shell/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[取模运算和求余运算的区别]]></title>
    <link href="http://zin.so/2014/04/16/diff-mod-rem/"/>
    <id>http://zin.so/2014/04/16/diff-mod-rem/</id>
    <published>2014-04-16T04:46:59.000Z</published>
    <updated>2014-08-12T14:16:51.000Z</updated>
    <content type="html"><![CDATA[<p>通常情况下取模运算(mod)和求余(rem)运算被混为一谈，因为在大多数的编程语言里，都用’%’符号表示取模或者求余运算。在这里要提醒大家要十分注意当前环境下’%’运算符的具体意义，因为在有负数存在的情况下，两者的结果是不一样的。</p>
<p>对于整型数a，b来说，取模运算或者求余运算的方法都是：</p>
<p><span style="color: #0000ff;"><strong>1、求 整数商：c = a/b</strong></span></p>
<p><span style="color: #0000ff;"><strong>2、计算模或者余数：r = a - c*b</strong></span></p>
<p>求模运算和求余运算在第一步不同: <strong><span style="color: #ff0000;">求余运算在取c的值时，向0方向舍入（fix()函数）</span></strong>；</p>
<p>而<strong><span style="color: #ff0000;">取模运算在计算c的值时，向无穷小方向舍入（floor()函数）</span></strong>。</p>
<p>因此，当a和b符号一致时，求模运算和求余运算所得的c的值一致，因此结果一致。但是当符号不一致的时候，结果不一样。</p>
<p>具体来说，求模运算结果的符号和b一致，求余运算结果的符号和a一致。</p>
<p>在C语言中，%符号表示的是求余运算，在python脚本中，%表示的是取模。（通常取模运算中b不允许是负数，但是在python里面可以在%后面跟负数，因为python语言中除法的结果是向无穷小方向舍入，因此计算结果是取模！）</p>
<p>下面表格是一些典型的取模或者求余的值。</p>
<table>
<thead>
<tr>
<th style="text-align:center">a</th>
<th style="text-align:center">b</th>
<th style="text-align:center">C语言：a%b（求余）</th>
<th style="text-align:center">Python Shell：a%b（取模）</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">-3</td>
<td style="text-align:center">-5</td>
<td style="text-align:center">-3</td>
<td style="text-align:center">-3</td>
</tr>
<tr>
<td style="text-align:center">-3</td>
<td style="text-align:center">4</td>
<td style="text-align:center">-3 = -3 – (0) * 4</td>
<td style="text-align:center">1 = -3 – (-1) * 4</td>
</tr>
<tr>
<td style="text-align:center">-3</td>
<td style="text-align:center">2</td>
<td style="text-align:center">-1 = -3 – (-1) * 2</td>
<td style="text-align:center">1 = -3 – (-2) * 2</td>
</tr>
<tr>
<td style="text-align:center">-1</td>
<td style="text-align:center">6</td>
<td style="text-align:center">-1 = -1 – (0) * 6</td>
<td style="text-align:center">5 = -1 – (-1) * 6</td>
</tr>
<tr>
<td style="text-align:center">-4</td>
<td style="text-align:center">-3</td>
<td style="text-align:center">-1</td>
<td style="text-align:center">-1</td>
</tr>
<tr>
<td style="text-align:center">2</td>
<td style="text-align:center">4</td>
<td style="text-align:center">2</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">5</td>
<td style="text-align:center">3</td>
<td style="text-align:center">2</td>
<td style="text-align:center">2</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">-7</td>
<td style="text-align:center">4 = 4 – (0) * (-7)</td>
<td style="text-align:center">-3 = 4 – (-1) * (-7)</td>
</tr>
<tr>
<td style="text-align:center">4</td>
<td style="text-align:center">-3</td>
<td style="text-align:center">1 = 4 – (-1) * (-3)</td>
<td style="text-align:center">-2 = 4 – (-2) * (-3)</td>
</tr>
<tr>
<td style="text-align:center">-6</td>
<td style="text-align:center">-5</td>
<td style="text-align:center">-1</td>
<td style="text-align:center">-1</td>
</tr>
</tbody>
</table>
]]></content>
    
    
      <category term="c" scheme="http://zin.so/tags/c/"/>
    
      <category term="Python" scheme="http://zin.so/tags/Python/"/>
    
      <category term="运算" scheme="http://zin.so/tags/%E8%BF%90%E7%AE%97/"/>
    
      <category term="Code" scheme="http://zin.so/categories/Code/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Nagios攻略 - 安装与配置]]></title>
    <link href="http://zin.so/2014/04/10/install-nagios/"/>
    <id>http://zin.so/2014/04/10/install-nagios/</id>
    <published>2014-04-10T06:56:17.000Z</published>
    <updated>2014-08-13T17:05:51.000Z</updated>
    <content type="html"><![CDATA[<p><strong>简介：</strong> Nagios 全名为（Nagios Ain’t Goona Insist on Saintood），最初项目名字是 NetSaint。它是一款免费的开源 IT 基础设施监控系统，其功能强大，灵活性强，能有效监控 Windows 、Linux、VMware 和 Unix 主机状态，交换机、路由器等网络设置等。一旦主机或服务状态出现异常时，会发出邮件或短信报警第一时间通知 IT 运营人员，在状态恢复后发出正常的邮件或短信通知。Nagios 结构简单，可维护性强，越来越受中小企业青睐，以及运维和管理人员的使用。同时提供一个可选的基于浏览器的 Web 界面，方便管理人员查看系统的运行状态，网络状态、服务状态、日志信息，以及其他异常现象。</p>
<hr>
<p><strong>Nagios 监控实现原理</strong></p>
<p>Nagios 软件需安装在一台独立的服务器上运行，这台服务器称为监控中心，监控中心服务器可以采用 Linux 或 Unix 操作系统；每一台被监视的硬件主机或服务都运行一个与监控中心服务器进行通信的 Nagios 软件后台程序，也可以理解为 Agent 或插件均可。监控中心服务器读取配置文件中的指令与远程的守护程序进行通信，并且指示远程的守护程序进行必要的检查。虽然 Nagios 软件必须在 Linux 或 Unix 操作系统上运行，但是远程被监控的机器可以是任何能够与其进行通信的主机，根据远程主机返回的应答，Naigos 将依据配置进行回应；接着 Nagios 将通过本地的机器进行测试，如果检测返回值不正确，Nagios 将通过一种或多种方式报警；具体原理如下图所示：<br><em>图 1. Nagios 监控原理图</em><br><img src="https://zinway.me/wp-content/uploads/2014/04/nagios001.jpg" alt="Nagios 原理图"></p>
<hr>
<h1 id="Nagios_安装与配置">Nagios 安装与配置</h1>
<p>下载相关软件包（<a href="http://sourceforge.net/projects/nagios/files/" title="Nagios相关软件下载" target="_blank" rel="external">Nagios</a> &amp;&amp; <a href="http://www.centreon.com/Content-Download/donwload-centreon-monitoring-tools" title="Centreon相关软件下载" target="_blank" rel="external">Centreon</a>）</p>
<p><strong><em>Nagios 安装：</em></strong></p>
<p>创建nagios用户和组</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">➜  ~  groupadd -g <span class="number">6000</span> nagios</div><div class="line">➜  ~  groupadd -g <span class="number">6001</span> nagcmd</div><div class="line">➜  ~  useradd -u <span class="number">6000</span> -g nagios -G nagcmd <span class="operator">-d</span> /home/nagios -c <span class="string">"Nagios Admin"</span> nagios</div><div class="line">➜  ~</div></pre></td></tr></table></figure>

<p>编译安装Nagios</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">➜  nagios  tar -zxvf nagios-<span class="number">4.0</span><span class="number">.4</span>.tar.gz </div><div class="line">➜  nagios  cd nagios-<span class="number">4.0</span><span class="number">.4</span> </div><div class="line">➜  nagios-<span class="number">4.0</span><span class="number">.4</span>  ./configure --prefix=/usr/local/nagios --<span class="keyword">with</span>-nagios-user=nagios --<span class="keyword">with</span>-nagios-<span class="keyword">group</span>=nagios --<span class="keyword">with</span>-command-user=nagios --<span class="keyword">with</span>-command-<span class="keyword">group</span>=nagcmd --enable-<span class="keyword">event</span>-broker --enable-nanosleep --enable-embedded-perl --<span class="keyword">with</span>-perlcache</div><div class="line">➜  nagios-<span class="number">4.0</span><span class="number">.4</span>  make all</div><div class="line">...</div><div class="line">*** Compile finished ***</div><div class="line"></div><div class="line"><span class="keyword">If</span> the main program <span class="keyword">and</span> CGIs compiled without any errors, you</div><div class="line">can <span class="keyword">continue</span> <span class="keyword">with</span> installing Nagios <span class="keyword">as</span> follows (type <span class="comment">'make'</span></div><div class="line">without any arguments <span class="keyword">for</span> a list <span class="keyword">of</span> all possible options):</div><div class="line"></div><div class="line">  make install</div><div class="line">     - This installs the main program, CGIs, <span class="keyword">and</span> HTML files</div><div class="line"></div><div class="line">  make install-init</div><div class="line">     - This installs the init script <span class="keyword">in</span> /etc/rc.d/init.d</div><div class="line"></div><div class="line">  make install-commandmode</div><div class="line">     - This installs <span class="keyword">and</span> configures permissions <span class="keyword">on</span> the</div><div class="line">       directory <span class="keyword">for</span> holding the external command file</div><div class="line"></div><div class="line">  make install-config</div><div class="line">     - This installs *SAMPLE* config files <span class="keyword">in</span> /usr/local/nagios/etc</div><div class="line">       You<span class="comment">'ll have to modify these sample files before you can</span></div><div class="line">       use Nagios.  Read the HTML documentation <span class="keyword">for</span> more info</div><div class="line">       <span class="keyword">on</span> doing this.  Pay particular attention <span class="keyword">to</span> the docs <span class="keyword">on</span></div><div class="line">       <span class="built_in">object</span> configuration files, <span class="keyword">as</span> they determine what/how</div><div class="line">       things <span class="keyword">get</span> monitored!</div><div class="line"></div><div class="line">  make install-webconf</div><div class="line">     - This installs the Apache config file <span class="keyword">for</span> the Nagios</div><div class="line">       web <span class="keyword">interface</span></div><div class="line"></div><div class="line">  make install-exfoliation</div><div class="line">     - This installs the Exfoliation theme <span class="keyword">for</span> the Nagios</div><div class="line">       web <span class="keyword">interface</span></div><div class="line"></div><div class="line">  make install-classicui</div><div class="line">     - This installs the classic theme <span class="keyword">for</span> the Nagios</div><div class="line">       web <span class="keyword">interface</span></div><div class="line">...</div><div class="line">➜  nagios-<span class="number">4.0</span><span class="number">.4</span></div></pre></td></tr></table></figure>

<p>编译安装Nagios插件</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">➜  nagios  tar -zxvf nagios-plugins-<span class="number">2.0</span>.tar.gz </div><div class="line">➜  nagios  <span class="keyword">cd</span> nagios-plugins-<span class="number">2.0</span> </div><div class="line">➜  nagios-plugins-<span class="number">2.0</span>  ./configure --prefix=/usr/local/nagios --with-nagios-user=nagios --with-nagios-group=nagios [--with-ipv6=<span class="keyword">no</span>]</div><div class="line">➜  nagios-plugins-<span class="number">2.0</span>  <span class="keyword">make</span> -j4</div><div class="line">➜  nagios-plugins-<span class="number">2.0</span>  <span class="keyword">make</span> install</div></pre></td></tr></table></figure>

<p>编译安装ndoutils</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">➜  nagios  tar zxvf ndoutils-2.0.0.tar.gz </div><div class="line">➜  nagios  cd ndoutils-2.0.0 </div><div class="line">➜  ndoutils-2.0.0  ./configure <span class="comment">--prefix=/usr/local/nagios --enable-mysql --with-ndo2db-user=nagios --with-ndo2db-group=nagios </span></div><div class="line">➜  ndoutils-2.0.0  make -j4</div><div class="line">➜  ndoutils-2.0.0  make <span class="operator"><span class="keyword">install</span></span></div><div class="line">➜  ndoutils-<span class="number">2.0</span><span class="number">.0</span>  cp ./config/ndo2db.cfg-sample /usr/<span class="keyword">local</span>/nagios/etc/ndo2db.cfg</div><div class="line">➜  ndoutils-<span class="number">2.0</span><span class="number">.0</span>  cp ./config/ndomod.cfg-sample /usr/<span class="keyword">local</span>/nagios/etc/ndomod.cfg</div><div class="line">➜  ndoutils-<span class="number">2.0</span><span class="number">.0</span>  chmod <span class="number">774</span> /usr/<span class="keyword">local</span>/nagios/<span class="keyword">bin</span>/ndo*</div><div class="line">➜  ndoutils-<span class="number">2.0</span><span class="number">.0</span>  chown nagios:nagios /usr/<span class="keyword">local</span>/nagios/etc/ndo*</div><div class="line">➜  ndoutils-<span class="number">2.0</span><span class="number">.0</span>  cp ./daemon-init /etc/init.d/ndo2db</div><div class="line">➜  ndoutils-<span class="number">2.0</span><span class="number">.0</span>  chmod +x /etc/init.d/ndo2db</div><div class="line">➜  ndoutils-<span class="number">2.0</span><span class="number">.0</span>  chkconfig <span class="comment">--add ndo2db</span></div><div class="line">➜  ndoutils-<span class="number">2.0</span><span class="number">.0</span>  service ndo2db <span class="keyword">start</span></div><div class="line"><span class="keyword">Starting</span> ndo2db: done.</div><div class="line">➜  ndoutils-<span class="number">2.0</span><span class="number">.0</span></div></pre></td></tr></table></figure>

<p>编译安装Centreon</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">➜  nagios  tar zxvf centreon-<span class="number">2.5</span>.<span class="number">0</span>.tar.gz </div><div class="line">➜  nagios  <span class="keyword">cd</span> centreon-<span class="number">2.5</span>.<span class="number">0</span> </div><div class="line">➜  centreon-<span class="number">2.5</span>.<span class="number">0</span>  ./install.<span class="keyword">sh</span> -<span class="keyword">i</span></div></pre></td></tr></table></figure>

<p><em><strong>Nagios 配置：</strong></em></p>
<p>启动Nagios服务</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">➜  ~  chkconfig <span class="comment">--add nagios</span></div><div class="line">➜  ~  service nagios <span class="operator"><span class="keyword">start</span></span></div><div class="line"><span class="keyword">Starting</span> nagios: done.</div><div class="line">➜  ~</div></pre></td></tr></table></figure>

<p>&nbsp;</p>
<p>&nbsp;</p>
<p>（未完待续）</p>
]]></content>
    
    
      <category term="Nagios" scheme="http://zin.so/tags/Nagios/"/>
    
      <category term="Tools" scheme="http://zin.so/categories/Tools/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[WordPress通过unix socket连接MySQL]]></title>
    <link href="http://zin.so/2014/04/09/using-mysql-socket-in-wordpress/"/>
    <id>http://zin.so/2014/04/09/using-mysql-socket-in-wordpress/</id>
    <published>2014-04-09T11:14:30.000Z</published>
    <updated>2014-08-13T17:14:43.000Z</updated>
    <content type="html"><![CDATA[<p>今天在自己server上（/tmp目录下）测试一些东西，测完以后，ls了一下，发现好多临时文件，然后强迫症犯了，手一抖给rm -rf ./* 掉了。删掉以后本blog就报连不上数据库的错了，发现是把 /tmp/mysql.sock 给干掉了。但是在/tmp下面放这么孤零零的一个文件难受呀（强迫症，伤不起），怎么办呢？</p>
<p>后面就去改my.cnf（mysql的配置文件）里面socket的路径，改完重启MySQL以后，发现WordPress还是连不上MySQL，但是socket文件确实已经在磁盘上换地方了。</p>
<p>开WordPress的debug模式（测试完成后记得关闭掉），</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">define</span></span>(<span class="string">'WP_DEBUG'</span>, <span class="literal">true</span>);</div></pre></td></tr></table></figure>

<p>发现WordPress还是去连原来的/tmp/mysql.sock，当然找不到文件了。</p>
<p>Google了下，发现可以直接在wp-config.php里面指定mysql-socket地址。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">define</span></span>(<span class="string">'DB_HOST'</span>, <span class="string">':/var/run/mysqld/mysqld.sock'</span>);</div></pre></td></tr></table></figure>

<p>直接指定了socket地址，刷新了下就恢复了。</p>
<hr>
<p>下面总结下WordPress通过unix socket连接MySQL的方法：</p>
<p>1、在my.cnf里面设置socket地址；</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socket      = <span class="regexp">/var/run</span><span class="regexp">/mysqld/mysqld</span>.sock</div></pre></td></tr></table></figure>

<p>通过执行下面的SQL查询，你也可以看到当前MySQL的socket位置路径：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">SHOW</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">'socket'</span>;</span></div></pre></td></tr></table></figure>

<p>2、在wp-config.php里面设置’DB_HOST’到’:/path/to/mysql.sock’（具体的socket文件路径），下面这几种写法都可以（注意’:’冒号就行）；</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">define</span></span>(<span class="string">'DB_HOST'</span>, <span class="string">':/var/run/mysqld/mysqld.sock'</span>);</div><div class="line"><span class="class"><span class="keyword">define</span></span>(<span class="string">'DB_HOST'</span>, <span class="string">'localhost:/var/run/mysqld/mysqld.sock'</span>);</div><div class="line"><span class="class"><span class="keyword">define</span></span>(<span class="string">'DB_HOST'</span>, <span class="string">'127.0.0.1:/var/run/mysqld/mysqld.sock'</span>);</div></pre></td></tr></table></figure>

<p>3、如果其他地方也不需要使用到3306端口，为了安全起见，可以直接在my.cnf里面禁用掉；</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="attr_selector">[mysqld]</span></div><div class="line"><span class="tag">skip-networking</span></div></pre></td></tr></table></figure>

<p>保存，重启下MySQL，netstat -tlnp查看下端口，就会发现3306消失掉了。</p>
]]></content>
    
    
      <category term="MySQL" scheme="http://zin.so/tags/MySQL/"/>
    
      <category term="LNMP Stack" scheme="http://zin.so/categories/LNMP-Stack/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[在CentOS6.5上安装HHVM3.0(解决依赖问题)]]></title>
    <link href="http://zin.so/2014/03/25/install-hhvm/"/>
    <id>http://zin.so/2014/03/25/install-hhvm/</id>
    <published>2014-03-25T15:20:30.000Z</published>
    <updated>2014-08-13T17:31:17.000Z</updated>
    <content type="html"><![CDATA[<p>前几天（03月21日），Facebook 正式发布专门用于 HHVM 的编程语言 Hack，然后就突然想装个HHVM来跑我的blog玩一下，后面也确实开始折腾了。</p>
<p>03月22日晚上就试水了下，按GitHub上或者是HHVM官网上的教程来的，提示依赖的几个编译环境的版本太低了。然后就去折腾找更新的rpm啊（各种第三方repo，各种Google），发现了一个悲剧的现状：目前CentOS6下还木有现成的高版本的编译环境的rpm，然后那天晚上时间也不早了就放弃了。</p>
<p>03月25日晚上，就又突然想起这个事，然后就又搞起来了。</p>
<p>办法嘛只有1个：那就是用老的（低版本的）编译环境去编译一个新的（高版本的）编译环境。好像有点绕，就拿gcc举个例子，目前是用gcc 4.4.7编译了个gcc 4.8.2，这就是悲催的现实。</p>
<p>低版本的环境：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="title">[</span><span class="comment">root@</span> <span class="comment">~</span><span class="title">]</span><span class="comment">#</span> <span class="comment">type</span> <span class="comment">gcc</span></div><div class="line"><span class="comment">gcc</span> <span class="comment">is</span> <span class="comment">/usr/bin/gcc</span></div><div class="line"><span class="title">[</span><span class="comment">root@</span> <span class="comment">~</span><span class="title">]</span><span class="comment">#</span> <span class="comment">gcc</span> <span class="literal">-</span><span class="comment">v</span></div><div class="line"><span class="comment">使用内建</span> <span class="comment">specs。</span></div><div class="line"><span class="comment">目标：x86_64</span><span class="literal">-</span><span class="comment">redhat</span><span class="literal">-</span><span class="comment">linux</span></div><div class="line"><span class="comment">配置为：</span><span class="string">.</span><span class="string">.</span><span class="comment">/configure</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">prefix=/usr</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">mandir=/usr/share/man</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">infodir=/usr/share/info</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">bugurl=http://bugzilla</span><span class="string">.</span><span class="comment">redhat</span><span class="string">.</span><span class="comment">com/bugzilla</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">enable</span><span class="literal">-</span><span class="comment">bootstrap</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">enable</span><span class="literal">-</span><span class="comment">shared</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">enable</span><span class="literal">-</span><span class="comment">threads=posix</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">enable</span><span class="literal">-</span><span class="comment">checking=release</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">system</span><span class="literal">-</span><span class="comment">zlib</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">enable</span><span class="literal">-</span><span class="comment">__cxa_atexit</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">disable</span><span class="literal">-</span><span class="comment">libunwind</span><span class="literal">-</span><span class="comment">exceptions</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">enable</span><span class="literal">-</span><span class="comment">gnu</span><span class="literal">-</span><span class="comment">unique</span><span class="literal">-</span><span class="comment">object</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">enable</span><span class="literal">-</span><span class="comment">languages=c</span><span class="string">,</span><span class="comment">c</span><span class="literal">+</span><span class="literal">+</span><span class="string">,</span><span class="comment">objc</span><span class="string">,</span><span class="comment">obj</span><span class="literal">-</span><span class="comment">c</span><span class="literal">+</span><span class="literal">+</span><span class="string">,</span><span class="comment">java</span><span class="string">,</span><span class="comment">fortran</span><span class="string">,</span><span class="comment">ada</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">enable</span><span class="literal">-</span><span class="comment">java</span><span class="literal">-</span><span class="comment">awt=gtk</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">disable</span><span class="literal">-</span><span class="comment">dssi</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">java</span><span class="literal">-</span><span class="comment">home=/usr/lib/jvm/java</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">5</span><span class="string">.</span><span class="comment">0</span><span class="literal">-</span><span class="comment">gcj</span><span class="literal">-</span><span class="comment">1</span><span class="string">.</span><span class="comment">5</span><span class="string">.</span><span class="comment">0</span><span class="string">.</span><span class="comment">0/jre</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">enable</span><span class="literal">-</span><span class="comment">libgcj</span><span class="literal">-</span><span class="comment">multifile</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">enable</span><span class="literal">-</span><span class="comment">java</span><span class="literal">-</span><span class="comment">maintainer</span><span class="literal">-</span><span class="comment">mode</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">ecj</span><span class="literal">-</span><span class="comment">jar=/usr/share/java/eclipse</span><span class="literal">-</span><span class="comment">ecj</span><span class="string">.</span><span class="comment">jar</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">disable</span><span class="literal">-</span><span class="comment">libjava</span><span class="literal">-</span><span class="comment">multilib</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">ppl</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">cloog</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">tune=generic</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span><span class="literal">-</span><span class="comment">arch_32=i686</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">build=x86_64</span><span class="literal">-</span><span class="comment">redhat</span><span class="literal">-</span><span class="comment">linux</span></div><div class="line"><span class="comment">线程模型：posix</span></div><div class="line"><span class="comment">gcc</span> <span class="comment">版本</span> <span class="comment">4</span><span class="string">.</span><span class="comment">4</span><span class="string">.</span><span class="comment">7</span> <span class="comment">20120313</span> <span class="comment">(Red</span> <span class="comment">Hat</span> <span class="comment">4</span><span class="string">.</span><span class="comment">4</span><span class="string">.</span><span class="comment">7</span><span class="literal">-</span><span class="comment">4)</span> <span class="comment">(GCC)</span> </div><div class="line"><span class="title">[</span><span class="comment">root@</span> <span class="comment">~</span><span class="title">]</span><span class="comment">#</span></div></pre></td></tr></table></figure>

<p>编译完的高版本：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">[root@ ~]<span class="comment"># gcc -v</span></div><div class="line">使用内建 specs。</div><div class="line"><span class="variable">COLLECT_GCC=</span>gcc</div><div class="line"><span class="variable">COLLECT_LTO_WRAPPER=</span>/usr/local/libexec/gcc/x86_64-unknown-linux-gnu/<span class="number">4.8</span>.<span class="number">2</span>/lto-wrapper</div><div class="line">目标：x86_64-unknown-linux-gnu</div><div class="line">配置为：./configure <span class="variable">--enable-checking=</span>release <span class="variable">--enable-languages=</span>c,c++ --disable-multilib</div><div class="line">线程模型：posix</div><div class="line">gcc 版本 <span class="number">4.8</span>.<span class="number">2</span> (GCC) </div><div class="line">[root@ ~]<span class="comment">#</span></div></pre></td></tr></table></figure>

<p>上面只是把GCC 4.8.2编译安装了，后面还要替换下系统的链接库：/usr/lib64/libstdc++.so.6</p>
<p>旧版和新版GLIBC支持的对比：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">[root@ ~]<span class="comment"># strings /usr/lib64/libstdc++.so.6.bak |grep GLIBC</span></div><div class="line">GLIBCXX_3.<span class="number">4</span></div><div class="line">GLIBCXX_3.<span class="number">4.1</span></div><div class="line">GLIBCXX_3.<span class="number">4.2</span></div><div class="line">GLIBCXX_3.<span class="number">4.3</span></div><div class="line">GLIBCXX_3.<span class="number">4.4</span></div><div class="line">GLIBCXX_3.<span class="number">4.5</span></div><div class="line">GLIBCXX_3.<span class="number">4.6</span></div><div class="line">GLIBCXX_3.<span class="number">4.7</span></div><div class="line">GLIBCXX_3.<span class="number">4.8</span></div><div class="line">GLIBCXX_3.<span class="number">4.9</span></div><div class="line">GLIBCXX_3.<span class="number">4.10</span></div><div class="line">GLIBCXX_3.<span class="number">4.11</span></div><div class="line">GLIBCXX_3.<span class="number">4.12</span></div><div class="line">GLIBCXX_3.<span class="number">4.13</span></div><div class="line">GLIBC_2.<span class="number">2.5</span></div><div class="line">GLIBC_2.<span class="number">3</span></div><div class="line">GLIBC_2.<span class="number">4</span></div><div class="line">GLIBC_2.<span class="number">3.2</span></div><div class="line">GLIBCXX_FORCE_NEW</div><div class="line">GLIBCXX_DEBUG_MESSAGE_LENGTH</div><div class="line">[root@ ~]<span class="comment"># strings /usr/lib64/libstdc++.so.6 |grep GLIBC</span></div><div class="line">GLIBCXX_3.<span class="number">4</span></div><div class="line">GLIBCXX_3.<span class="number">4.1</span></div><div class="line">GLIBCXX_3.<span class="number">4.2</span></div><div class="line">GLIBCXX_3.<span class="number">4.3</span></div><div class="line">GLIBCXX_3.<span class="number">4.4</span></div><div class="line">GLIBCXX_3.<span class="number">4.5</span></div><div class="line">GLIBCXX_3.<span class="number">4.6</span></div><div class="line">GLIBCXX_3.<span class="number">4.7</span></div><div class="line">GLIBCXX_3.<span class="number">4.8</span></div><div class="line">GLIBCXX_3.<span class="number">4.9</span></div><div class="line">GLIBCXX_3.<span class="number">4.10</span></div><div class="line">GLIBCXX_3.<span class="number">4.11</span></div><div class="line">GLIBCXX_3.<span class="number">4.12</span></div><div class="line">GLIBCXX_3.<span class="number">4.13</span></div><div class="line">GLIBCXX_3.<span class="number">4.14</span></div><div class="line">GLIBCXX_3.<span class="number">4.15</span></div><div class="line">GLIBCXX_3.<span class="number">4.16</span></div><div class="line">GLIBCXX_3.<span class="number">4.17</span></div><div class="line">GLIBCXX_3.<span class="number">4.18</span></div><div class="line">GLIBCXX_3.<span class="number">4.19</span></div><div class="line">GLIBC_2.<span class="number">3</span></div><div class="line">GLIBC_2.<span class="number">2.5</span></div><div class="line">GLIBC_2.<span class="number">3.2</span></div><div class="line">GLIBCXX_FORCE_NEW</div><div class="line">GLIBCXX_DEBUG_MESSAGE_LENGTH</div><div class="line">[root@ ~]<span class="comment">#</span></div></pre></td></tr></table></figure>

<p>03月26日，下面类似编译cmake等依赖环境。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@ ~]<span class="comment"># cmake --version</span></div><div class="line">cmake <span class="property">version</span> <span class="number">2.6</span>-patch <span class="number">4</span></div><div class="line">[root@ ~]<span class="comment"># </span></div><div class="line">==&gt;</div><div class="line">[root@ ~]<span class="comment"># cmake --version</span></div><div class="line">cmake <span class="property">version</span> <span class="number">2.8</span><span class="number">.12</span><span class="number">.2</span></div><div class="line">[root@ ~]<span class="comment">#</span></div></pre></td></tr></table></figure>

<p>截止到03月26日21:44，终于把依赖的环境全编译好了。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div></pre></td><td class="code"><pre><div class="line">[root@ hhvm]# cmake .</div><div class="line">Using HPHP_HOME == /root/hhvm_tmp/hhvm</div><div class="line">-<span class="ruby">- <span class="constant">CMAKE_PREFIX_PATH</span> was missing, proceeding anyway</span></div><div class="line">-<span class="ruby">- <span class="constant">Boost</span> <span class="symbol">version:</span> <span class="number">1.55</span>.<span class="number">0</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> the following <span class="constant">Boost</span> <span class="symbol">libraries:</span></span></div><div class="line">-<span class="ruby">-   system</span></div><div class="line">-<span class="ruby">-   program_options</span></div><div class="line">-<span class="ruby">-   filesystem</span></div><div class="line">-<span class="ruby">-   regex</span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">LibMagicWand</span><span class="symbol">:</span> /usr/lib64/libMagickWand.so  </span></div><div class="line">-<span class="ruby">- <span class="constant">MySQL</span> <span class="constant">Include</span> <span class="symbol">dir:</span> /usr/<span class="keyword">include</span>/mysql  library <span class="symbol">dir:</span> /usr/lib64/mysql</span></div><div class="line">-<span class="ruby">- <span class="constant">MySQL</span> client <span class="symbol">libraries:</span> mysqlclient_r</span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">PCRE</span><span class="symbol">:</span> /usr/lib64/libpcre.so  </span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="symbol">libevent:</span> /usr/lib64/libevent.so</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> evhttp_bind_socket_with_fd</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> evhttp_bind_socket_with_fd - <span class="keyword">not</span> found</span></div><div class="line">-<span class="ruby">- <span class="constant">Could</span> <span class="constant">NOT</span> find <span class="constant">LibUODBC</span> (<span class="symbol">missing:</span>  <span class="constant">LIBODBC_LIBRARIES</span> <span class="constant">LIBODBC_INCLUDE_DIRS</span>) </span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">LibJpeg</span><span class="symbol">:</span> /usr/lib64/libjpeg.so  </span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">LibPng</span><span class="symbol">:</span> /usr/lib64/libpng.so  </span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">PkgConfig</span><span class="symbol">:</span> /usr/bin/pkg-config (found version <span class="string">"0.23"</span>) </span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">Freetype</span><span class="symbol">:</span> /usr/lib64/libfreetype.so  </span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">CURL</span><span class="symbol">:</span> /usr/lib64/libcurl.so (found version <span class="string">"7.37.0-DEV"</span>) </span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> curl_multi_select</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> curl_multi_select - <span class="keyword">not</span> found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> curl_multi_wait</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> curl_multi_wait - <span class="keyword">not</span> found</span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">LibXml2</span><span class="symbol">:</span> /usr/lib64/libxml2.so (found version <span class="string">"2.7.6"</span>) </span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">LibXslt</span><span class="symbol">:</span> /usr/lib64/libxslt.so (found version <span class="string">"1.1.26"</span>) </span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">EXPAT</span><span class="symbol">:</span> /usr/lib64/libexpat.so (found version <span class="string">"2.0.1"</span>) </span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">ICU</span> header files <span class="keyword">in</span> /usr/<span class="keyword">include</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">ICU</span> <span class="symbol">libraries:</span> /usr/lib64/libicuuc.so</span></div><div class="line">-<span class="ruby">- <span class="constant">Performing</span> <span class="constant">Test</span> <span class="constant">JEMALLOC_VERSION_3</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Performing</span> <span class="constant">Test</span> <span class="constant">JEMALLOC_VERSION_3</span> - <span class="constant">Success</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="symbol">jemalloc:</span> /usr/lib64/libjemalloc.so</span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">Intel</span> <span class="constant">TBB</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="symbol">mcrypt:</span> /usr/lib64/libmcrypt.so</span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">OpenSSL</span><span class="symbol">:</span> /usr/lib64/libssl.so;<span class="regexp">/usr/lib</span>64/libcrypto.so (found version <span class="string">"1.0.1e"</span>) </span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">ZLIB</span><span class="symbol">:</span> /usr/lib64/libz.so (found version <span class="string">"1.2.3"</span>) </span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">BZip2</span><span class="symbol">:</span> /usr/lib64/libbz2.so (found version <span class="string">"1.0.5"</span>) </span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="constant">BZ2_bzCompressInit</span> <span class="keyword">in</span> /usr/lib64/libbz2.so</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="constant">BZ2_bzCompressInit</span> <span class="keyword">in</span> /usr/lib64/libbz2.so - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">ONIGURUMA</span><span class="symbol">:</span> /usr/lib64/libonig.so  </span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="symbol">ldap:</span> /usr/lib64/libldap.so;<span class="regexp">/usr/lib</span>64/liblber.so</span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">LIBPTHREAD</span><span class="symbol">:</span> /usr/lib64/libpthread.so  </span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">Readline</span><span class="symbol">:</span> /usr/<span class="keyword">include</span>  </span></div><div class="line">-<span class="ruby">- <span class="constant">Could</span> <span class="constant">NOT</span> find <span class="constant">Editline</span> (<span class="symbol">missing:</span>  <span class="constant">EDITLINE_LIBRARIES</span> <span class="constant">EDITLINE_INCLUDE_DIRS</span>) </span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">LibElf</span><span class="symbol">:</span> /usr/lib64/libelf.so  </span></div><div class="line">-<span class="ruby">- <span class="constant">Performing</span> <span class="constant">Test</span> <span class="constant">ELF_GETSHDRSTRNDX</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Performing</span> <span class="constant">Test</span> <span class="constant">ELF_GETSHDRSTRNDX</span> - <span class="constant">Success</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="constant">LibDwarf</span><span class="symbol">:</span> /usr/lib64/libdwarf.so  </span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> dwarf_encode_leb128</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> dwarf_encode_leb128 - found</span></div><div class="line">Generating Release build</div><div class="line">-<span class="ruby">- <span class="constant">Performing</span> <span class="constant">Test</span> <span class="constant">FOLLY_IFUNC</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Performing</span> <span class="constant">Test</span> <span class="constant">FOLLY_IFUNC</span> - <span class="constant">Failed</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> clock_gettime</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> clock_gettime - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> arpa/inet.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> arpa/inet.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> netinet/<span class="keyword">in</span>.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> netinet/<span class="keyword">in</span>.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> stddef.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> stddef.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> stdint.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> stdint.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> string.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> string.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> sys/socket.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> sys/socket.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> sys/time.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> sys/time.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> unistd.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> unistd.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> sys/types.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> sys/types.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> stdint.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> stdint.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> stddef.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> stddef.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of size_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of size_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of ssize_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of ssize_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of uint32_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of uint32_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of uint8_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of uint8_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="constant">AF_LOCAL</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="constant">AF_LOCAL</span> - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="constant">PF_LOCAL</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="constant">PF_LOCAL</span> - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> memset</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> memset - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> socket</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> socket - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> strerror</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> strerror - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> <span class="symbol">libevent:</span> /usr/lib64/libevent.so</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> event_get_version_number</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> event_get_version_number - <span class="keyword">not</span> found</span></div><div class="line">-<span class="ruby">- <span class="constant">Performing</span> <span class="constant">Test</span> <span class="constant">HAVE_LIBEVENT_145</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Performing</span> <span class="constant">Test</span> <span class="constant">HAVE_LIBEVENT_145</span> - <span class="constant">Success</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> libevent <span class="number">1.4</span>.<span class="number">5</span>+</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file stdlib.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file stdlib.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file assert.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file assert.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> strcasecmp</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> strcasecmp - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> strchr</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> strchr - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file sys/stat.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file sys/stat.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file stdlib.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file stdlib.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file string.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file string.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file memory.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file memory.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file strings.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file strings.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file inttypes.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file inttypes.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file unistd.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file unistd.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file dlfcn.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file dlfcn.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> fdatasync</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> fdatasync - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> usleep</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> usleep - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> fullfsync</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> fullfsync - <span class="keyword">not</span> found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> localtime_r</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> localtime_r - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> gmtime_r</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> gmtime_r - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> pthread_create <span class="keyword">in</span> pthread</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> pthread_create <span class="keyword">in</span> pthread - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> <span class="keyword">if</span> the system is big endian</span></div><div class="line">-<span class="ruby">- <span class="constant">Searching</span> <span class="number">16</span> bit integer</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of unsigned short</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of unsigned short - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Using</span> unsigned short</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> <span class="keyword">if</span> the system is big endian - little endian</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file locale.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file locale.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file limits.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file limits.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of int32_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of int32_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> strtoll</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> strtoll - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> atoll</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> atoll - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> strftime</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> strftime - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> setlocale</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> setlocale - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Boost</span> <span class="symbol">version:</span> <span class="number">1.55</span>.<span class="number">0</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> the following <span class="constant">Boost</span> <span class="symbol">libraries:</span></span></div><div class="line">-<span class="ruby">-   system</span></div><div class="line">-<span class="ruby">-   program_options</span></div><div class="line">-<span class="ruby">-   filesystem</span></div><div class="line">-<span class="ruby">-   regex</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _close</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _close - <span class="keyword">not</span> found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _dup</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _dup - <span class="keyword">not</span> found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _fdopen</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _fdopen - <span class="keyword">not</span> found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _fileno</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _fileno - <span class="keyword">not</span> found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _open</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _open - <span class="keyword">not</span> found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _snprintf</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _snprintf - <span class="keyword">not</span> found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _strdup</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _strdup - <span class="keyword">not</span> found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _stricmp</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> _stricmp - <span class="keyword">not</span> found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> fseeko</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> fseeko - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> ftello</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> ftello - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> open</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> open - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> mkstemp</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> mkstemp - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> snprintf</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> snprintf - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> strdup</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> strdup - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="constant">MoveFileExA</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="constant">MoveFileExA</span> - <span class="keyword">not</span> found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file sys/types.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file sys/types.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file inttypes.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file inttypes.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file stdint.h</span></div><div class="line">-<span class="ruby">- <span class="constant">Looking</span> <span class="keyword">for</span> <span class="keyword">include</span> file stdint.h - found</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of __int8</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of __int8 - failed</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of int8_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of int8_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of uint8_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of uint8_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of __int16</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of __int16 - failed</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of int16_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of int16_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of uint16_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of uint16_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of __int32</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of __int32 - failed</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of int32_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of int32_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of uint32_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of uint32_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of __int64</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of __int64 - failed</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of int64_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of int64_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of uint64_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of uint64_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of short</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of short - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of int</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of int - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of long</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of long - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of long long</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of long long - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of off_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of off_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of size_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of size_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of ssize_t</span></div><div class="line">-<span class="ruby">- <span class="constant">Check</span> size of ssize_t - done</span></div><div class="line">-<span class="ruby">- <span class="constant">Boost</span> <span class="symbol">version:</span> <span class="number">1.55</span>.<span class="number">0</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> the following <span class="constant">Boost</span> <span class="symbol">libraries:</span></span></div><div class="line">-<span class="ruby">-   thread</span></div><div class="line">-<span class="ruby">-   system</span></div><div class="line">-<span class="ruby">- <span class="constant">Boost</span> <span class="symbol">version:</span> <span class="number">1.55</span>.<span class="number">0</span></span></div><div class="line">-<span class="ruby">- <span class="constant">Found</span> the following <span class="constant">Boost</span> <span class="symbol">libraries:</span></span></div><div class="line">-<span class="ruby">-   thread</span></div><div class="line">-<span class="ruby">-   system</span></div><div class="line">-<span class="ruby">- <span class="constant">OCaml</span> <span class="keyword">not</span> found, will <span class="keyword">not</span> build <span class="constant">Hack</span> typechecker</span></div><div class="line">-<span class="ruby">- <span class="constant">Configuring</span> done</span></div><div class="line">-<span class="ruby">- <span class="constant">Generating</span> done</span></div><div class="line">-<span class="ruby">- <span class="constant">Build</span> files have been written <span class="symbol">to:</span> /root/hhvm_tmp/hhvm</span></div><div class="line">[root@ hhvm]#</div></pre></td></tr></table></figure>

<p>下一步就是跑HHVM的make。</p>
<p>03月27日21:30</p>
<p>我去，HHVM的编译卡在imagick了：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">[ <span class="number">51</span>%] Building CXX object hphp/runtime/CMakeFiles/hphp_runtime_static.dir/ext/imagick/ext_imagick.cpp.o</div><div class="line">[ <span class="number">51</span>%] Building CXX object hphp/runtime/CMakeFiles/hphp_runtime_static.dir/ext/imagick/constants.cpp.o</div><div class="line">/root/hhvm/hphp/runtime/ext/imagick/constants.cpp: 在函数‘<span class="keyword">void</span> HPHP::loadImagickConstants()’中:</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">760</span>:<span class="number">52</span>: 错误：‘ModulusAddCompositeOp’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_COMPOSITE_MODULUSADD, ModulusAddCompositeOp);</div><div class="line">                                                    ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">762</span>:<span class="number">28</span>: 错误：‘ModulusSubtractCompositeOp’在此作用域中尚未声明</div><div class="line">                            ModulusSubtractCompositeOp);</div><div class="line">                            ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">809</span>:<span class="number">43</span>: 错误：‘JincFilter’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_FILTER_JINC, JincFilter);</div><div class="line">                                           ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">810</span>:<span class="number">47</span>: 错误：‘SincFastFilter’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_FILTER_SINCFAST, SincFastFilter);</div><div class="line">                                               ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">811</span>:<span class="number">47</span>: 错误：‘RobidouxFilter’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_FILTER_ROBIDOUX, RobidouxFilter);</div><div class="line">                                               ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">812</span>:<span class="number">51</span>: 错误：‘LanczosSharpFilter’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_FILTER_LANCZOSSHARP, LanczosSharpFilter);</div><div class="line">                                                   ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">813</span>:<span class="number">47</span>: 错误：‘Lanczos2Filter’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_FILTER_LANCZOS2, Lanczos2Filter);</div><div class="line">                                               ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">814</span>:<span class="number">52</span>: 错误：‘Lanczos2SharpFilter’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_FILTER_LANCZOS2SHARP, Lanczos2SharpFilter);</div><div class="line">                                                    ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">864</span>:<span class="number">48</span>: 错误：‘ZipSCompression’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_COMPRESSION_ZIPS, ZipSCompression);</div><div class="line">                                                ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">865</span>:<span class="number">47</span>: 错误：‘PizCompression’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_COMPRESSION_PIZ, PizCompression);</div><div class="line">                                               ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">866</span>:<span class="number">49</span>: 错误：‘Pxr24Compression’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_COMPRESSION_PXR24, Pxr24Compression);</div><div class="line">                                                 ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">867</span>:<span class="number">47</span>: 错误：‘B44Compression’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_COMPRESSION_B44, B44Compression);</div><div class="line">                                               ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">868</span>:<span class="number">48</span>: 错误：‘B44ACompression’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_COMPRESSION_B44A, B44ACompression);</div><div class="line">                                                ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">869</span>:<span class="number">48</span>: 错误：‘LZMACompression’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_COMPRESSION_LZMA, LZMACompression);</div><div class="line">                                                ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">944</span>:<span class="number">44</span>: 错误：‘SyncChannels’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_CHANNEL_SYNC, SyncChannels);</div><div class="line">                                            ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">1006</span>:<span class="number">45</span>: 错误：‘MeanEvaluateOperator’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_EVALUATE_MEAN, MeanEvaluateOperator);</div><div class="line">                                             ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">1007</span>:<span class="number">44</span>: 错误：‘AbsEvaluateOperator’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_EVALUATE_ABS, AbsEvaluateOperator);</div><div class="line">                                            ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">1009</span>:<span class="number">28</span>: 错误：‘ExponentialEvaluateOperator’在此作用域中尚未声明</div><div class="line">                            ExponentialEvaluateOperator);</div><div class="line">                            ^</div><div class="line"><span class="regexp">/root/</span>hhvm/hphp/runtime/ext/imagick/constants.cpp:<span class="number">1010</span>:<span class="number">47</span>: 错误：‘MedianEvaluateOperator’在此作用域中尚未声明</div><div class="line">   registerImagickConstants(s_EVALUATE_MEDIAN, MedianEvaluateOperator);</div><div class="line">                                               ^</div><div class="line">make[<span class="number">2</span>]: *** [hphp/runtime/CMakeFiles/hphp_runtime_static.dir/ext/imagick/constants.cpp.o] 错误 <span class="number">1</span></div><div class="line">make[<span class="number">1</span>]: *** [hphp/runtime/CMakeFiles/hphp_runtime_static.dir/all] 错误 <span class="number">2</span></div><div class="line">make: *** [all] 错误 <span class="number">2</span></div><div class="line">➜</div></pre></td></tr></table></figure>

<p>靠，果然是被yum默认装的ImageMagick-devel给坑了：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="constant">IMAGEMAGICK_BINARY_PATH</span><span class="symbol">:PATH=/usr/bin</span></div><div class="line"><span class="constant">IMAGEMAGICK_COMPOSITE_EXECUTABLE</span><span class="symbol">:FILEPATH=/usr/bin/composite</span></div><div class="line"><span class="constant">IMAGEMAGICK_CONVERT_EXECUTABLE</span><span class="symbol">:FILEPATH=/usr/bin/convert</span></div><div class="line"><span class="constant">IMAGEMAGICK_IMPORT_EXECUTABLE</span><span class="symbol">:FILEPATH=/usr/bin/import</span></div><div class="line"><span class="constant">IMAGEMAGICK_MOGRIFY_EXECUTABLE</span><span class="symbol">:FILEPATH=/usr/bin/mogrify</span></div><div class="line"><span class="constant">IMAGEMAGICK_MONTAGE_EXECUTABLE</span><span class="symbol">:FILEPATH=/usr/bin/montage</span></div><div class="line"><span class="constant">ImageMagick_EXECUTABLE_DIR</span><span class="symbol">:PATH=/usr/bin</span></div><div class="line"><span class="constant">ImageMagick_MagickCore_INCLUDE_DIR</span><span class="symbol">:PATH=/usr/include/ImageMagick</span></div><div class="line"><span class="constant">ImageMagick_MagickCore_LIBRARY</span><span class="symbol">:FILEPATH=/usr/lib64/libMagickCore</span>.so</div><div class="line"><span class="constant">ImageMagick_MagickWand_INCLUDE_DIR</span><span class="symbol">:PATH=/usr/include/ImageMagick</span></div><div class="line"><span class="constant">ImageMagick_MagickWand_LIBRARY</span><span class="symbol">:FILEPATH=/usr/lib64/libMagickWand</span>.so</div></pre></td></tr></table></figure>

<p>怒删之。</p>
<p>03月29日凌晨01:08</p>
<p>终于在CentOS 6.5上把HHVM3.0编译出来了，来回折腾了小7个晚上。</p>
<p>（各种环境版本问题，还有”/usr/lib64”和”/usr/lib”的问题等等，坑死~）</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">[ <span class="number">93</span>%] Building CXX object hphp/runtime/ext_hhvm/CMakeFiles/ext_hhvm_static.dir/ext_hhvm_infotabs.cpp.o</div><div class="line">Linking CXX static library libext_hhvm.a</div><div class="line">[ <span class="number">93</span>%] Built target ext_hhvm_static</div><div class="line">[ <span class="number">97</span>%] Built target hphp_util</div><div class="line">[ <span class="number">98</span>%] Built target vixl</div><div class="line">[ <span class="number">98</span>%] Built target hphp_zend</div><div class="line">[ <span class="number">98</span>%] Generating systemlib.php</div><div class="line">[ <span class="number">98</span>%] Built target systemlib</div><div class="line">Scanning dependencies of target hhvm</div><div class="line">[ <span class="number">98</span>%] Building CXX object hphp/hhvm/CMakeFiles/hhvm.dir/main.cpp.o</div><div class="line">[ <span class="number">99</span>%] Building CXX object hphp/hhvm/CMakeFiles/hhvm.dir/process-init.cpp.o</div><div class="line">[ <span class="number">99</span>%] Building CXX object hphp/hhvm/CMakeFiles/hhvm.dir/<span class="built_in">global</span>-variables.cpp.o</div><div class="line">Linking CXX executable hhvm</div><div class="line">Embedding php <span class="keyword">in</span> hhvm</div><div class="line">[ <span class="number">99</span>%] Built target hhvm</div><div class="line">Scanning dependencies of target <span class="keyword">test</span></div><div class="line">[ <span class="number">99</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_ext_memcached.cpp.o</div><div class="line">[ <span class="number">99</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/main.cpp.o</div><div class="line">[ <span class="number">99</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_util.cpp.o</div><div class="line">[ <span class="number">99</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_logger.cpp.o</div><div class="line">[ <span class="number">99</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_base.cpp.o</div><div class="line">[ <span class="number">99</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_parser.cpp.o</div><div class="line">[ <span class="number">99</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_server.cpp.o</div><div class="line">[ <span class="number">99</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_parser_stmt.cpp.o</div><div class="line">[<span class="number">100</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/<span class="keyword">test</span>.cpp.o</div><div class="line">[<span class="number">100</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_code_error.cpp.o</div><div class="line">[<span class="number">100</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_all.cpp.o</div><div class="line">[<span class="number">100</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_ext_server.cpp.o</div><div class="line">[<span class="number">100</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_cpp_base.cpp.o</div><div class="line">[<span class="number">100</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_fastcgi.cpp.o</div><div class="line">[<span class="number">100</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_ext_apc.cpp.o</div><div class="line">[<span class="number">100</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_parser_expr.cpp.o</div><div class="line">[<span class="number">100</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_ext_mysql.cpp.o</div><div class="line">[<span class="number">100</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_fastcgi_protocol.cpp.o</div><div class="line">[<span class="number">100</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_code_run.cpp.o</div><div class="line">[<span class="number">100</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/ext/test_cpp_ext.cpp.o</div><div class="line">[<span class="number">100</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/__/hhvm/process-init.cpp.o</div><div class="line">[<span class="number">100</span>%] Building CXX object hphp/<span class="keyword">test</span>/CMakeFiles/<span class="keyword">test</span>.dir/__/hhvm/<span class="built_in">global</span>-variables.cpp.o</div><div class="line">Linking CXX executable <span class="keyword">test</span></div><div class="line">Embedding php <span class="keyword">in</span> <span class="keyword">test</span></div><div class="line">[<span class="number">100</span>%] Built target <span class="keyword">test</span></div><div class="line">➜  hhvm git:(HHVM-<span class="number">3.0</span>) ✗</div></pre></td></tr></table></figure>



<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">➜  hhvm git:(HHVM-<span class="number">3.0</span>) ✗ make install</div><div class="line">[  <span class="number">2</span><span class="variable">%]</span> Built target folly</div><div class="line">[  <span class="number">2</span><span class="variable">%]</span> Built target double-conversion</div><div class="line">[  <span class="number">3</span><span class="variable">%]</span> Built target gen-class-map</div><div class="line">[  <span class="number">3</span><span class="variable">%]</span> Built target gen-ext-hhvm</div><div class="line">[  <span class="number">3</span><span class="variable">%]</span> Built target gen-infotabs</div><div class="line">[  <span class="number">3</span><span class="variable">%]</span> Built target afdt</div><div class="line">[  <span class="number">8</span><span class="variable">%]</span> Built target mbfl</div><div class="line">[  <span class="number">8</span><span class="variable">%]</span> Built target sqlite3</div><div class="line">[  <span class="number">9</span><span class="variable">%]</span> Built target timelib</div><div class="line">[  <span class="number">9</span><span class="variable">%]</span> Built target lz4</div><div class="line">[ <span class="number">15</span><span class="variable">%]</span> Built target zip_shared</div><div class="line">[ <span class="number">21</span><span class="variable">%]</span> Built target zip_static</div><div class="line">[ <span class="number">23</span><span class="variable">%]</span> Built target hphp_thrift</div><div class="line">[ <span class="number">23</span><span class="variable">%]</span> Built target hphp_proxygen</div><div class="line">[ <span class="number">23</span><span class="variable">%]</span> Built target hphp_system</div><div class="line">[ <span class="number">23</span><span class="variable">%]</span> Built target hphp_parser</div><div class="line">[ <span class="number">30</span><span class="variable">%]</span> Built target hphp_analysis</div><div class="line">[ <span class="number">32</span><span class="variable">%]</span> Built target hphp_hhbbc</div><div class="line">[ <span class="number">33</span><span class="variable">%]</span> Built target neo</div><div class="line">[ <span class="number">68</span><span class="variable">%]</span> Built target hphp_runtime_static</div><div class="line">[ <span class="number">96</span><span class="variable">%]</span> Built target ext_hhvm_static</div><div class="line">[<span class="number">100</span><span class="variable">%]</span> Built target hphp_util</div><div class="line">[<span class="number">100</span><span class="variable">%]</span> Built target vixl</div><div class="line">[<span class="number">100</span><span class="variable">%]</span> Built target hphp_zend</div><div class="line">[<span class="number">100</span><span class="variable">%]</span> Generating systemlib.php</div><div class="line">[<span class="number">100</span><span class="variable">%]</span> Built target systemlib</div><div class="line">Linking CXX executable hhvm</div><div class="line">Embedding php <span class="keyword">in</span> hhvm</div><div class="line">[<span class="number">100</span><span class="variable">%]</span> Built target hhvm</div><div class="line">Install the project...</div><div class="line">-- Install configuration: <span class="string">""</span></div><div class="line">-- Installing: /usr/lib/libzip.a</div><div class="line">-- Installing: /usr/lib/libzip.so</div><div class="line">-- Removed runtime path from <span class="string">"/usr/lib/libzip.so"</span></div><div class="line">-- Installing: /usr/include/zipconf.h</div><div class="line">-- Installing: /usr/include/zip.h</div><div class="line">-- Installing: /usr/bin/hhvm</div><div class="line">-- Installing: /usr/bin/hphpize</div><div class="line">➜  hhvm git:(HHVM-<span class="number">3.0</span>) ✗</div></pre></td></tr></table></figure>

<p>来，下面就是HHVM的测试了。</p>
<p>首先看下—version和—help</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line">➜  ~  hhvm --version</div><div class="line">HipHop VM 3.0.1 (rel)</div><div class="line">Compiler: tags/HHVM-3.0.1-0-g1da451b79f40686de6472d23cf90fdd09fa4dc23</div><div class="line">Repo schema: 11f0d546efba889ced1f9b92d9c9249f494d0b84</div><div class="line">➜  ~  hhvm --help</div><div class="line">Usage:</div><div class="line">   hhvm [-m &lt;mode&gt;] [&lt;options&gt;] [&lt;arg1&gt;] [&lt;arg2&gt;] ...</div><div class="line">Options:</div><div class="line">  -<span class="ruby">-help                                display this message</span></div><div class="line">  -<span class="ruby">-version                             display version number</span></div><div class="line">  -<span class="ruby">-php                                 emulate the standard php command line</span></div><div class="line">  -<span class="ruby">-compiler-id                         display the git hash <span class="keyword">for</span> the compiler</span></div><div class="line">  -<span class="ruby">-repo-schema                         display the repository schema id</span></div><div class="line">  -<span class="ruby">m [ --mode ] arg (=run)              run | debug (d) | server (s) | daemon |</span></div><div class="line">                                        replay | translate (t)</div><div class="line">  -<span class="ruby">a [ --interactive ]                  <span class="constant">Shortcut</span> <span class="keyword">for</span> --mode debug</span></div><div class="line">  -<span class="ruby">c [ --config ] arg                   load specified config file</span></div><div class="line">  -<span class="ruby">v [ --config-value ] arg             individual configuration string <span class="keyword">in</span> a </span></div><div class="line">                                        format of name=value, where name can be</div><div class="line">                                        any valid configuration for a config </div><div class="line">                                        file</div><div class="line">  -<span class="ruby">p [ --port ] arg (=-<span class="number">1</span>)               start an <span class="constant">HTTP</span> server at specified port</span></div><div class="line">  -<span class="ruby">-port-fd arg (=-<span class="number">1</span>)                   use specified fd instead of creating a </span></div><div class="line">                                        socket</div><div class="line">  -<span class="ruby">-ssl-port-fd arg (=-<span class="number">1</span>)               use specified fd <span class="keyword">for</span> <span class="constant">SSL</span> instead of </span></div><div class="line">                                        creating a socket</div><div class="line">  -<span class="ruby">-admin-port arg (=-<span class="number">1</span>)                start admin listener at specified port</span></div><div class="line">  -<span class="ruby">-debug-config arg                    load specified debugger config file</span></div><div class="line">  -<span class="ruby">h [ --debug-host ] [=arg(=localhost)]</span></div><div class="line">                                        connect to debugger server at specified</div><div class="line">                                        address</div><div class="line">  -<span class="ruby">-debug-port arg (=-<span class="number">1</span>)                connect to debugger server at specified</span></div><div class="line">                                        port</div><div class="line">  -<span class="ruby">-debug-extension arg                 <span class="constant">PHP</span> file that extends y command</span></div><div class="line">  -<span class="ruby">-debug-cmd arg                       executes this debugger command <span class="keyword">and</span> </span></div><div class="line">                                        returns its output in stdout</div><div class="line">  -<span class="ruby">-debug-sandbox arg (=default)        initial sandbox to attach to <span class="keyword">when</span> </span></div><div class="line">                                        debugger is started</div><div class="line">  -<span class="ruby">u [ --user ] arg                     run server under this user account</span></div><div class="line">  -<span class="ruby">f [ --file ] arg                     executing specified file</span></div><div class="line">  -<span class="ruby">l [ --lint ] arg                     lint specified file</span></div><div class="line">  -<span class="ruby">w [ --show ] arg                     output specified file <span class="keyword">and</span> <span class="keyword">do</span> nothing </span></div><div class="line">                                        else</div><div class="line">  -<span class="ruby">-temp-file                           file specified is temporary <span class="keyword">and</span> removed</span></div><div class="line">                                        after execution</div><div class="line">  -<span class="ruby">-count arg (=<span class="number">1</span>)                      how many times to repeat execution</span></div><div class="line">  -<span class="ruby">-no-safe-access-check arg (=<span class="number">0</span>)       whether to ignore safe file access </span></div><div class="line">                                        check</div><div class="line">  -<span class="ruby">-arg arg                             arguments</span></div><div class="line">  -<span class="ruby">-extra-header arg                    extra-header to add to log lines</span></div><div class="line">  -<span class="ruby">-build-id arg                        unique identifier of compiled server </span></div><div class="line">                                        code</div><div class="line">  -<span class="ruby">-instance-id arg                     unique identifier of server instance</span></div><div class="line">  -<span class="ruby">-xhprof-flags arg (=<span class="number">0</span>)               <span class="constant">Set</span> <span class="constant">XHProf</span> flags</span></div><div class="line">➜  ~</div></pre></td></tr></table></figure>

<p>1、CPU密集型测试</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">➜  hhvm_test  cat t1.php      </div><div class="line">&lt;?php</div><div class="line">function fib(<span class="variable">$n</span>)</div><div class="line">{</div><div class="line">    <span class="keyword">if</span> (<span class="variable">$n</span> &lt;= <span class="number">2</span>)</div><div class="line">        <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">    <span class="keyword">else</span></div><div class="line">        <span class="keyword">return</span> fib(<span class="variable">$n</span>-<span class="number">1</span>) + fib(<span class="variable">$n</span>-<span class="number">2</span>);</div><div class="line">}</div><div class="line"><span class="variable">$n</span> = <span class="number">36</span>;</div><div class="line"><span class="keyword">printf</span>(<span class="string">"fib(<span class="variable">%d</span>) = <span class="variable">%d</span>\n"</span>, <span class="variable">$n</span>, fib(<span class="variable">$n</span>, <span class="number">2</span>));</div><div class="line">?&gt;</div><div class="line">➜  hhvm_test  <span class="keyword">time</span> php t1.php </div><div class="line">fib(<span class="number">36</span>) = <span class="number">14930352</span></div><div class="line">php t1.php  <span class="number">10.04</span><span class="keyword">s</span> user <span class="number">0</span>.<span class="number">02</span><span class="keyword">s</span> <span class="keyword">system</span> <span class="number">99</span>% cpu <span class="number">10.072</span> total</div><div class="line">➜  hhvm_test  <span class="keyword">time</span> hhvm t1.php </div><div class="line">fib(<span class="number">36</span>) = <span class="number">14930352</span></div><div class="line">hhvm t1.php  <span class="number">0</span>.<span class="number">52</span><span class="keyword">s</span> user <span class="number">0</span>.<span class="number">12</span><span class="keyword">s</span> <span class="keyword">system</span> <span class="number">52</span>% cpu <span class="number">1.226</span> total</div><div class="line">➜  hhvm_test</div></pre></td></tr></table></figure>

<p>2、内存密集型测试</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">➜  hhvm_test  cat t2.php </div><div class="line"><span class="preprocessor">&lt;?php</span></div><div class="line">ini_set(<span class="string">'memory_limit'</span>,<span class="string">'1024M'</span>);</div><div class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>();</div><div class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>; <span class="variable">$i</span> &lt; <span class="number">2000000</span> ; <span class="variable">$i</span>++) {</div><div class="line">    <span class="variable">$arr</span>[<span class="variable">$i</span>] = <span class="variable">$i</span>;  </div><div class="line">}</div><div class="line"><span class="variable">$arr2</span> = <span class="keyword">array</span>();</div><div class="line"><span class="keyword">foreach</span>(<span class="variable">$arr</span> <span class="keyword">as</span> <span class="variable">$val</span>){</div><div class="line">    <span class="variable">$arr2</span>[] = <span class="variable">$val</span> . <span class="variable">$val</span>;</div><div class="line">}</div><div class="line"><span class="preprocessor">?&gt;</span></div><div class="line">➜  hhvm_test  time php t2.php </div><div class="line">php t2.php  <span class="number">2.29</span>s user <span class="number">1.13</span>s system <span class="number">99</span>% cpu <span class="number">3.427</span> total</div><div class="line">➜  hhvm_test  time hhvm t2.php </div><div class="line">hhvm t2.php  <span class="number">1.60</span>s user <span class="number">0.73</span>s system <span class="number">79</span>% cpu <span class="number">2.934</span> total</div><div class="line">➜  hhvm_test</div></pre></td></tr></table></figure>

<p>从上面2个测试可以看出，CPU的消耗明显减少。</p>
<hr>
<p>最后，这边安装HHVM的目的就是想要用HHVM来跑WordPress（nginx -&gt; fastcgi -&gt; hhvm），按照官方的教程（<a href="https://github.com/facebook/hhvm/wiki/fastcgi）来配置了FastCGI" target="_blank" rel="external">https://github.com/facebook/hhvm/wiki/fastcgi）来配置了FastCGI</a> ，但是因为本blog是跑在ssl/(https)上的，测试下来有证书问题。</p>
<p>正在研究HHVM SSL证书问题。</p>
<p>（未完待续）</p>
]]></content>
    
    
      <category term="HHVM" scheme="http://zin.so/tags/HHVM/"/>
    
      <category term="LNMP Stack" scheme="http://zin.so/categories/LNMP-Stack/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[本blog上的Drawing特效]]></title>
    <link href="http://zin.so/2014/03/25/drawing/"/>
    <id>http://zin.so/2014/03/25/drawing/</id>
    <published>2014-03-25T09:24:40.000Z</published>
    <updated>2014-08-11T16:02:59.000Z</updated>
    <content type="html"><![CDATA[<p>用本篇文章来发布研究drawing.js的一些log</p>
<p>PS：其实这个js是以前从Sivan的blog（ <a href="http://lightcss.com/" target="_blank" rel="external">http://lightcss.com/</a> ）上“偷”来的。</p>
<p>源码GitHub地址：<a href="https://github.com/Zinway-Liu/drawing" title="Drawing" target="_blank" rel="external">https://github.com/Zinway-Liu/drawing</a></p>
<p>&nbsp;</p>
]]></content>
    
    
      <category term="js" scheme="http://zin.so/tags/js/"/>
    
      <category term="JavaScript" scheme="http://zin.so/categories/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[首页refresh重定向]]></title>
    <link href="http://zin.so/2014/03/19/meta-refresh/"/>
    <id>http://zin.so/2014/03/19/meta-refresh/</id>
    <published>2014-03-19T06:20:32.000Z</published>
    <updated>2014-08-18T10:59:42.000Z</updated>
    <content type="html"><![CDATA[<p>昨天评估了半天，想用前端的方式来实现类似nginx rewrite这样一个重定向的效果，主要是想80重定向到443。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="title">server</span> {</div><div class="line">    <span class="title">listen</span>      <span class="number">80</span>;</div><div class="line">    <span class="title">server_name</span> zinway.me;</div><div class="line">    <span class="title">rewrite</span><span class="regexp"> ^(.\*)</span> <span class="url">https://$server_name$1</span> <span class="built_in">permanent</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>看到“baidu.com”首页有这样一个通过meta refresh的方式来重定向到“www.baidu.com”的案例。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">➜  ~  curl <span class="attribute">-vv</span> baidu<span class="built_in">.</span>com</div><div class="line"><span class="subst">\*</span> Adding <span class="keyword">handle</span>: conn: <span class="number">0x7f8261004400</span></div><div class="line"><span class="subst">\*</span> Adding <span class="keyword">handle</span>: send: <span class="number">0</span></div><div class="line"><span class="subst">\*</span> Adding <span class="keyword">handle</span>: recv: <span class="number">0</span></div><div class="line"><span class="subst">\*</span> Curl_addHandleToPipeline: length: <span class="number">1</span></div><div class="line"><span class="subst">\*</span> <span class="subst">-</span> Conn <span class="number">0</span> (<span class="number">0x7f8261004400</span>) send_pipe: <span class="number">1</span>, recv_pipe: <span class="number">0</span></div><div class="line"><span class="subst">\*</span> About <span class="keyword">to</span> connect() <span class="keyword">to</span> baidu<span class="built_in">.</span>com port <span class="number">80</span> (<span class="variable">#0</span>)</div><div class="line"><span class="subst">\*</span>   Trying <span class="number">220.181</span><span class="number">.111</span><span class="number">.85</span><span class="attribute">...</span></div><div class="line"><span class="subst">\*</span> Connected <span class="keyword">to</span> baidu<span class="built_in">.</span>com (<span class="number">220.181</span><span class="number">.111</span><span class="number">.85</span>) port <span class="number">80</span> (<span class="variable">#0</span>)</div><div class="line"><span class="subst">&gt;</span> GET <span class="subst">/</span> HTTP/<span class="number">1.1</span></div><div class="line"><span class="subst">&gt;</span> User<span class="attribute">-Agent</span>: curl/<span class="number">7.30</span><span class="number">.0</span></div><div class="line"><span class="subst">&gt;</span> Host: baidu<span class="built_in">.</span>com</div><div class="line"><span class="subst">&gt;</span> Accept: <span class="subst">\*</span><span class="subst">/</span><span class="subst">\*</span></div><div class="line"><span class="subst">&gt;</span></div><div class="line"><span class="subst">&lt;</span> HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</div><div class="line"><span class="subst">&lt;</span> <span class="built_in">Date</span>: Wed, <span class="number">19</span> Mar <span class="number">2014</span> <span class="number">04</span>:<span class="number">28</span>:<span class="number">24</span> GMT</div><div class="line"><span class="subst">\*</span> Server Apache is <span class="literal">not</span> blacklisted</div><div class="line"><span class="subst">&lt;</span> Server: Apache</div><div class="line"><span class="subst">&lt;</span> <span class="keyword">Cache</span><span class="attribute">-Control</span>: <span class="keyword">max</span><span class="attribute">-age</span><span class="subst">=</span><span class="number">86400</span></div><div class="line"><span class="subst">&lt;</span> Expires: Thu, <span class="number">20</span> Mar <span class="number">2014</span> <span class="number">04</span>:<span class="number">28</span>:<span class="number">24</span> GMT</div><div class="line"><span class="subst">&lt;</span> Last<span class="attribute">-Modified</span>: Tue, <span class="number">12</span> Jan <span class="number">2010</span> <span class="number">13</span>:<span class="number">48</span>:<span class="number">00</span> GMT</div><div class="line"><span class="subst">&lt;</span> ETag: <span class="string">"51-4b4c7d90"</span></div><div class="line"><span class="subst">&lt;</span> Accept<span class="attribute">-Ranges</span>: <span class="built_in">bytes</span></div><div class="line"><span class="subst">&lt;</span> Content<span class="attribute">-Length</span>: <span class="number">81</span></div><div class="line"><span class="subst">&lt;</span> Connection: Keep<span class="attribute">-Alive</span></div><div class="line"><span class="subst">&lt;</span> Content<span class="attribute">-Type</span>: text/html</div><div class="line"><span class="subst">&lt;</span></div><div class="line"><span class="subst">&lt;</span>html<span class="subst">&gt;</span></div><div class="line"><span class="subst">&lt;</span>meta http<span class="attribute">-equiv</span><span class="subst">=</span><span class="string">"refresh"</span> content<span class="subst">=</span><span class="string">"0;url=http://www.baidu.com/"</span><span class="subst">&gt;</span></div><div class="line"><span class="subst">&lt;</span>/html<span class="subst">&gt;</span></div><div class="line"><span class="subst">\*</span> Connection <span class="variable">#0</span> <span class="keyword">to</span> host baidu<span class="built_in">.</span>com left intact</div><div class="line">➜  ~</div></pre></td></tr></table></figure>

<p>这种方法把重定向丢给浏览器来处理，某种程度上减少了server端的开销，感觉不错。</p>
<p>但是我想实现的更复杂一些，通过前端的方式获取URL里面域名后面的参数（pathname，search，hash等），然后进行相应的重定向 。或许可以通过JS location.replace()来刷新。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="built_in">document</span>.location.replace(<span class="built_in">document</span>.location.toString().replace(<span class="string">"http:"</span>,<span class="string">"https:"</span>))</div><div class="line"><span class="tag">&lt;/<span class="title">script</span>&gt;</span></div></pre></td></tr></table></figure>

<p>URL字符串的处理，我这边的需求只要把”http:”替换成”https:”就行了。</p>
<p>最后，突然也想到前端是只要处理下URL字符串就行了，但是后端还是需要做个“<span style="color: #ff0000;"> * </span>”匹配到上面这个“index.html”的文件，server端还是会有一定的开销（跑一遍正则，然后丢给index.html，不亚于跑一遍rewrite）。</p>
<p>总结：貌似这样子搞下来，相比于server端直接用nginx rewrite一下有点得不偿失的感觉，特别是相比于只对首页进行meta refresh。而且一般重定向的话，也都是首页用到的多，具体的文档重定向倒是少见。</p>
<p>所以目前最后评估下来的方案是：要么就用meta refresh到首页；要么就用nginx的rewrite。折腾不来 ╮(╯▽╰)╭</p>
]]></content>
    
    
      <category term="refresh" scheme="http://zin.so/tags/refresh/"/>
    
      <category term="rewrite" scheme="http://zin.so/tags/rewrite/"/>
    
      <category term="LNMP Stack" scheme="http://zin.so/categories/LNMP-Stack/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Git常用命令别名]]></title>
    <link href="http://zin.so/2014/03/18/git-alias/"/>
    <id>http://zin.so/2014/03/18/git-alias/</id>
    <published>2014-03-18T06:22:47.000Z</published>
    <updated>2014-08-13T17:19:14.000Z</updated>
    <content type="html"><![CDATA[<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"># Aliases</div><div class="line"><span class="keyword">alias</span> g=<span class="attribute">'git</span>'</div><div class="line"><span class="keyword">alias</span> gst=<span class="attribute">'git</span> status'</div><div class="line"><span class="keyword">alias</span> gd=<span class="attribute">'git</span> diff'</div><div class="line"><span class="keyword">alias</span> gdc=<span class="attribute">'git</span> diff <span class="comment">--cached'</span></div><div class="line"><span class="keyword">alias</span> gl=<span class="attribute">'git</span> pull'</div><div class="line"><span class="keyword">alias</span> gup=<span class="attribute">'git</span> pull <span class="comment">--rebase'</span></div><div class="line"><span class="keyword">alias</span> gp=<span class="attribute">'git</span> push'</div><div class="line"><span class="keyword">alias</span> gd=<span class="attribute">'git</span> diff'</div><div class="line"><span class="keyword">alias</span> gc=<span class="attribute">'git</span> commit -v'</div><div class="line"><span class="keyword">alias</span> gc!=<span class="attribute">'git</span> commit -v <span class="comment">--amend'</span></div><div class="line"><span class="keyword">alias</span> gca=<span class="attribute">'git</span> commit -v -a'</div><div class="line"><span class="keyword">alias</span> gca!=<span class="attribute">'git</span> commit -v -a <span class="comment">--amend'</span></div><div class="line"><span class="keyword">alias</span> gcmsg=<span class="attribute">'git</span> commit -m'</div><div class="line"><span class="keyword">alias</span> gco=<span class="attribute">'git</span> checkout'</div><div class="line"><span class="keyword">alias</span> gcm=<span class="attribute">'git</span> checkout master'</div><div class="line"><span class="keyword">alias</span> gr=<span class="attribute">'git</span> remote'</div><div class="line"><span class="keyword">alias</span> grv=<span class="attribute">'git</span> remote -v'</div><div class="line"><span class="keyword">alias</span> grmv=<span class="attribute">'git</span> remote rename'</div><div class="line"><span class="keyword">alias</span> grrm=<span class="attribute">'git</span> remote remove'</div><div class="line"><span class="keyword">alias</span> grset=<span class="attribute">'git</span> remote set-url'</div><div class="line"><span class="keyword">alias</span> grup=<span class="attribute">'git</span> remote update'</div><div class="line"><span class="keyword">alias</span> grbi=<span class="attribute">'git</span> rebase -i'</div><div class="line"><span class="keyword">alias</span> grbc=<span class="attribute">'git</span> rebase <span class="comment">--continue'</span></div><div class="line"><span class="keyword">alias</span> grba=<span class="attribute">'git</span> rebase <span class="comment">--abort'</span></div><div class="line"><span class="keyword">alias</span> gb=<span class="attribute">'git</span> branch'</div><div class="line"><span class="keyword">alias</span> gba=<span class="attribute">'git</span> branch -a'</div><div class="line"><span class="keyword">alias</span> gcount=<span class="attribute">'git</span> shortlog -sn'</div><div class="line"><span class="keyword">alias</span> gcl=<span class="attribute">'git</span> config <span class="comment">--list'</span></div><div class="line"><span class="keyword">alias</span> gcp=<span class="attribute">'git</span> cherry-pick'</div><div class="line"><span class="keyword">alias</span> glg=<span class="attribute">'git</span> log <span class="comment">--stat --max-count=10'</span></div><div class="line"><span class="keyword">alias</span> glgg=<span class="attribute">'git</span> log <span class="comment">--graph --max-count=10'</span></div><div class="line"><span class="keyword">alias</span> glgga=<span class="attribute">'git</span> log <span class="comment">--graph --decorate --all'</span></div><div class="line"><span class="keyword">alias</span> glo=<span class="attribute">'git</span> log <span class="comment">--oneline'</span></div><div class="line"><span class="keyword">alias</span> gss=<span class="attribute">'git</span> status -s'</div><div class="line"><span class="keyword">alias</span> ga=<span class="attribute">'git</span> add'</div><div class="line"><span class="keyword">alias</span> gm=<span class="attribute">'git</span> merge'</div><div class="line"><span class="keyword">alias</span> grh=<span class="attribute">'git</span> reset HEAD'</div><div class="line"><span class="keyword">alias</span> grhh=<span class="attribute">'git</span> reset HEAD <span class="comment">--hard'</span></div><div class="line"><span class="keyword">alias</span> gclean=<span class="attribute">'git</span> reset <span class="comment">--hard &amp;&amp; git clean -dfx'</span></div><div class="line"><span class="keyword">alias</span> gwc=<span class="attribute">'git</span> whatchanged -p <span class="comment">--abbrev-commit --pretty=medium'</span></div></pre></td></tr></table></figure>

]]></content>
    
    
      <category term="alias" scheme="http://zin.so/tags/alias/"/>
    
      <category term="git" scheme="http://zin.so/tags/git/"/>
    
      <category term="Shell" scheme="http://zin.so/categories/Shell/"/>
    
  </entry>
  
</feed>
